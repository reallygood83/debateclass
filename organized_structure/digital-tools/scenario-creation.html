<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéØ AI ÌÜ†Î°† ÏãúÎÇòÎ¶¨Ïò§ ÏÉùÏÑ± ÏßÄÏõê ÎèÑÍµ¨</title>
    <style>
        /* ===== Í∏∞Î≥∏ ÏÑ§Ï†ï ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #3b82f6;
            --primary-hover: #2563eb;
            --secondary-color: #64748b;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --bg-color: #f8fafc;
            --card-bg: #ffffff;
            --text-color: #1f2937;
            --border-color: #e2e8f0;
            --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            /* Î™©Ï†ÅÎ≥Ñ ÏÉâÏÉÅ */
            --critical-color: #dc2626;
            --communication-color: #059669;
            --creative-color: #7c3aed;
            --democratic-color: #2563eb;
            --perspective-color: #ea580c;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f0f9ff 0%, #e0e7ff 100%);
            color: var(--text-color);
            line-height: 1.6;
            min-height: 100vh;
        }

        /* ===== Ìó§Îçî ===== */
        .header {
            text-align: center;
            padding: 40px 20px;
            background: linear-gradient(135deg, var(--primary-color), #3b82f6);
            color: white;
            box-shadow: var(--shadow-lg);
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        /* ===== Ïª®ÌÖåÏù¥ÎÑà ===== */
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }

        /* ===== Ïπ¥Îìú ===== */
        .card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
        }

        .card h2 {
            color: var(--primary-color);
            margin-bottom: 20px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card.guide {
            background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
            border: 2px solid #0ea5e9;
        }

        /* ===== ÏûÖÎ†• ÌïÑÎìú ===== */
        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-color);
        }

        .input-group input, .input-group select, .input-group textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .input-group input:focus, .input-group select:focus, .input-group textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        /* ===== Ï≤¥ÌÅ¨Î∞ïÏä§ Í∑∏Î£π ===== */
        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .checkbox-item input[type="checkbox"] {
            width: auto;
        }

        /* ===== Î≤ÑÌäº ===== */
        .btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            background: var(--primary-hover);
            transform: translateY(-1px);
            box-shadow: var(--shadow-lg);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-success {
            background: var(--success-color);
        }

        .btn-warning {
            background: var(--warning-color);
        }

        .btn-danger {
            background: var(--danger-color);
        }

        .btn-secondary {
            background: var(--secondary-color);
        }

        .btn-full {
            width: 100%;
            justify-content: center;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        /* ===== Ïà®ÍπÄ Ï≤òÎ¶¨ ===== */
        .hidden {
            display: none !important;
        }

        /* ===== ÏÉÅÌÉú Î©îÏãúÏßÄ ===== */
        .status-message {
            padding: 12px 20px;
            border-radius: 8px;
            margin: 20px 0;
            font-weight: 500;
        }

        .status-message.success {
            background: #dcfce7;
            color: #166534;
            border: 1px solid #bbf7d0;
        }

        .status-message.error {
            background: #fef2f2;
            color: #dc2626;
            border: 1px solid #fecaca;
        }

        .status-message.info {
            background: #eff6ff;
            color: #2563eb;
            border: 1px solid #dbeafe;
        }

        /* ===== Ï£ºÏ†ú ÏÑ†ÌÉù ===== */
        .topic-option {
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .topic-option:hover {
            border-color: var(--primary-color);
            box-shadow: var(--shadow);
            transform: translateY(-2px);
        }

        .topic-option.selected {
            border-color: var(--primary-color);
            background: linear-gradient(135deg, #eff6ff, #dbeafe);
            box-shadow: var(--shadow-lg);
        }

        .topic-option .select-indicator {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 20px;
            height: 20px;
            border: 2px solid var(--border-color);
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .topic-option.selected .select-indicator {
            background: var(--primary-color);
            border-color: var(--primary-color);
        }

        .topic-option.selected .select-indicator::after {
            content: '‚úì';
            color: white;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 12px;
            font-weight: bold;
        }

        .topic-option h3 {
            color: var(--primary-color);
            margin-bottom: 10px;
            padding-right: 40px;
        }

        .topic-description {
            color: var(--secondary-color);
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        .pro-con-preview {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }

        .pro-preview, .con-preview {
            padding: 12px;
            border-radius: 8px;
            font-size: 0.9rem;
        }

        .pro-preview {
            background: #f0f9ff;
            border-left: 4px solid var(--success-color);
        }

        .con-preview {
            background: #fef2f2;
            border-left: 4px solid var(--danger-color);
        }

        .pro-label, .con-label {
            font-weight: 600;
            display: block;
            margin-bottom: 5px;
        }

        /* ===== ÏãúÎÇòÎ¶¨Ïò§ Í≤∞Í≥º ===== */
        .scenario-section {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
        }

        .scenario-section h2 {
            color: var(--primary-color);
            font-size: 1.8rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .scenario-section h3 {
            color: var(--text-color);
            font-size: 1.3rem;
            margin: 20px 0 12px 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .scenario-section .icon {
            font-size: 1.2em;
        }

        .scenario-content {
            line-height: 1.7;
            color: var(--text-color);
        }

        .scenario-content p {
            margin-bottom: 15px;
        }

        .scenario-content ul {
            margin-left: 20px;
            margin-bottom: 15px;
        }

        .scenario-content li {
            margin-bottom: 8px;
        }

        /* ===== Î©îÌÉÄÎç∞Ïù¥ÌÑ∞ Í∑∏Î¶¨Îìú ===== */
        .metadata-section {
            background: linear-gradient(135deg, #f8fafc, #f1f5f9);
        }

        .metadata-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .metadata-item {
            padding: 15px;
            background: white;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .metadata-item strong {
            color: var(--primary-color);
            display: block;
            margin-bottom: 5px;
        }

        /* ===== Ï∞¨Î∞ò ÎÖºÏ†ê ===== */
        .pros-cons-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .pros-box, .cons-box {
            padding: 20px;
            border-radius: 12px;
            border: 2px solid;
        }

        .pros-box {
            background: linear-gradient(135deg, #f0fdf4, #dcfce7);
            border-color: var(--success-color);
        }

        .cons-box {
            background: linear-gradient(135deg, #fef2f2, #fee2e2);
            border-color: var(--danger-color);
        }

        .pros-box h4, .cons-box h4 {
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .pros-box h4 {
            color: var(--success-color);
        }

        .cons-box h4 {
            color: var(--danger-color);
        }

        /* ===== ÌïµÏã¨ ÏßàÎ¨∏Îì§ ===== */
        .key-questions-list {
            list-style: none;
        }

        .key-questions-list .question-item {
            background: linear-gradient(135deg, #fafafa, #f5f5f5);
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid var(--primary-color);
            font-weight: 500;
        }

        .key-questions-list .question-item:before {
            content: '‚ùì ';
            color: var(--primary-color);
        }

        /* ===== Í∏∞ÎåÄ ÌïôÏäµ ÏÑ±Í≥º ===== */
        .outcomes-list {
            list-style: none;
        }

        .outcomes-list li {
            background: linear-gradient(135deg, #eff6ff, #dbeafe);
            padding: 12px;
            margin-bottom: 8px;
            border-radius: 8px;
            border-left: 4px solid var(--primary-color);
        }

        .outcomes-list li:before {
            content: 'üéØ ';
            color: var(--primary-color);
        }

        /* ===== Ï§ÄÎπÑÎ¨º (ÌÜ†Í∏Ä) ===== */
        .materials-toggle {
            cursor: pointer;
            user-select: none;
            transition: color 0.3s ease;
        }

        .materials-toggle:hover {
            color: var(--primary-hover);
        }

        .toggle-indicator {
            transition: transform 0.3s ease;
        }

        .toggle-indicator.rotated {
            transform: rotate(180deg);
        }

        .materials-content {
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .materials-list li {
            background: #f8fafc;
            padding: 10px;
            margin-bottom: 5px;
            border-radius: 6px;
            border-left: 3px solid var(--warning-color);
        }

        .materials-list li:before {
            content: 'üì¶ ';
            color: var(--warning-color);
        }

        /* ===== ÍµêÏÇ¨ ÏßÄÎèÑ ÌåÅ ===== */
        .teacher-tips-content {
            background: linear-gradient(135deg, #fef9e7, #fef3c7);
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid var(--warning-color);
        }

        /* ===== Î™©Ï†ÅÎ≥Ñ ÏÉâÏÉÅ ===== */
        .purpose-critical {
            border-left-color: var(--critical-color) !important;
        }

        .purpose-communication {
            border-left-color: var(--communication-color) !important;
        }

        .purpose-creative {
            border-left-color: var(--creative-color) !important;
        }

        .purpose-democratic {
            border-left-color: var(--democratic-color) !important;
        }

        .purpose-perspective {
            border-left-color: var(--perspective-color) !important;
        }

        .purpose-tag {
            font-size: 0.8rem;
            padding: 4px 8px;
            border-radius: 12px;
            background: var(--primary-color);
            color: white;
            margin-left: 10px;
        }

        /* ===== Ïû¨Ï∂îÏ≤ú ÏÑπÏÖò ===== */
        .re-recommendation {
            background: linear-gradient(135deg, #fefce8, #fef3c7);
            border: 2px solid var(--warning-color);
            margin-top: 20px;
        }

        .feedback-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }

        .feedback-option {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            background: white;
            border-radius: 6px;
            font-size: 0.9rem;
        }

        /* ===== AI ÏßÑÌñâÎ•† ÌåùÏóÖ ===== */
        .ai-progress-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            animation: fadeIn 0.3s ease;
        }

        .ai-progress-modal {
            background: white;
            border-radius: 20px;
            padding: 40px 30px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: aiProgressSlideIn 0.5s ease;
        }

        .ai-progress-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            animation: bounce 2s infinite;
        }

        .ai-progress-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .ai-progress-subtitle {
            color: var(--secondary-color);
            margin-bottom: 30px;
            font-size: 0.95rem;
        }

        .ai-progress-bar-container {
            background: #f1f5f9;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 30px;
        }

        .ai-progress-bar {
            background: linear-gradient(90deg, var(--primary-color), var(--success-color));
            height: 100%;
            width: 0%;
            transition: width 0.5s ease;
        }

        .ai-progress-steps {
            text-align: left;
        }

        .ai-progress-step {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 0;
            color: var(--secondary-color);
            font-size: 0.95rem;
            transition: all 0.3s ease;
        }

        .ai-progress-step.active {
            color: var(--primary-color);
            font-weight: 600;
            transform: translateX(5px);
        }

        .ai-progress-step.completed {
            color: var(--success-color);
        }

        .ai-progress-step-icon {
            font-size: 1.2em;
            width: 20px;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes aiProgressSlideIn {
            from { 
                opacity: 0;
                transform: translateY(-20px) scale(0.9);
            }
            to { 
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }

        /* ===== Î∞òÏùëÌòï ÎîîÏûêÏù∏ ===== */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }

            .container {
                padding: 15px;
            }

            .card {
                padding: 20px;
                margin-bottom: 20px;
            }

            .pros-cons-container {
                grid-template-columns: 1fr;
            }

            .pro-con-preview {
                grid-template-columns: 1fr;
            }

            .action-buttons {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }

            .ai-progress-modal {
                margin: 20px;
                padding: 30px 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Ìó§Îçî -->
    <div class="header">
        <h1>üéØ AI ÌÜ†Î°† ÏãúÎÇòÎ¶¨Ïò§ ÏÉùÏÑ± ÏßÄÏõê ÎèÑÍµ¨</h1>
        <p>Ï¥àÎì± ÌÜ†Î°† ÍµêÏú°ÏùÑ ÏúÑÌïú ÎßûÏ∂§Ìòï ÏãúÎÇòÎ¶¨Ïò§Î•º AIÍ∞Ä ÏÉùÏÑ±Ìï¥ÎìúÎ¶ΩÎãàÎã§</p>
    </div>

    <div class="container">
        <!-- ÏÇ¨Ïö© Í∞ÄÏù¥Îìú -->
        <div class="card guide">
            <h2>üìã ÏÇ¨Ïö© Î∞©Î≤ï</h2>
            <p><strong>1Îã®Í≥Ñ:</strong> ÌÜ†Î°† Ï£ºÏ†úÏôÄ Í¥ÄÎ†®Îêú ÌÇ§ÏõåÎìúÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî (Ïòà: ÌôòÍ≤ΩÎ≥¥Ìò∏, Ïù∏Í≥µÏßÄÎä•, Ïä§ÎßàÌä∏Ìè∞ Îì±)</p>
            <p><strong>2Îã®Í≥Ñ:</strong> AIÍ∞Ä Ï∂îÏ≤úÌïú 3Í∞úÏùò Ï£ºÏ†ú Ï§ë ÏõêÌïòÎäî Í≤ÉÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</p>
            <p><strong>3Îã®Í≥Ñ:</strong> ÌïôÎÖÑ, ÍµêÍ≥º, ÌÜ†Î°† Î™©Ï†ÅÏùÑ ÏÑ§Ï†ïÌïòÍ≥† ÏãúÎÇòÎ¶¨Ïò§Î•º ÏÉùÏÑ±ÌïòÏÑ∏Ïöî</p>
            <p><strong>üí° ÌåÅ:</strong> Íµ¨Ï≤¥Ï†ÅÏù∏ ÌÇ§ÏõåÎìúÏùºÏàòÎ°ù Îçî Ï†ïÌôïÌïú Ï£ºÏ†ú Ï∂îÏ≤úÏùÑ Î∞õÏùÑ Ïàò ÏûàÏäµÎãàÎã§!</p>
        </div>

        <!-- ÏÉÅÌÉú Î©îÏãúÏßÄ -->
        <div id="status-message" class="status-message hidden"></div>

        <!-- 1Îã®Í≥Ñ: ÌÇ§ÏõåÎìú ÏûÖÎ†• Î∞è Ï£ºÏ†ú Ï∂îÏ≤ú -->
        <div class="card" id="topic-input">
            <h2>üîç 1Îã®Í≥Ñ: ÌÜ†Î°† Ï£ºÏ†ú ÌÇ§ÏõåÎìú ÏûÖÎ†•</h2>
            
            <div class="input-group">
                <label for="keyword">ÌÜ†Î°† Ï£ºÏ†ú ÌÇ§ÏõåÎìú</label>
                <input type="text" id="keyword" placeholder="Ïòà: ÌôòÍ≤ΩÎ≥¥Ìò∏, Ïù∏Í≥µÏßÄÎä•, Ïä§ÎßàÌä∏Ìè∞, ÎèÖÏÑú Îì±">
            </div>

            <div class="input-group">
                <label for="topic-purpose">ÌÜ†Î°† Î™©Ï†Å (ÏÑ†ÌÉùÏÇ¨Ìï≠)</label>
                <select id="topic-purpose">
                    <option value="">Î™©Ï†ÅÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî</option>
                    <option value="ÎπÑÌåêÏ†Å ÏÇ¨Í≥†Î†• Í∏∞Î•¥Í∏∞">ÎπÑÌåêÏ†Å ÏÇ¨Í≥†Î†• Í∏∞Î•¥Í∏∞</option>
                    <option value="ÏùòÏÇ¨ÏÜåÌÜµ Îä•Î†• Ìñ•ÏÉÅ">ÏùòÏÇ¨ÏÜåÌÜµ Îä•Î†• Ìñ•ÏÉÅ</option>
                    <option value="Îã§ÏñëÌïú Í¥ÄÏ†ê Ïù¥Ìï¥ÌïòÍ∏∞">Îã§ÏñëÌïú Í¥ÄÏ†ê Ïù¥Ìï¥ÌïòÍ∏∞</option>
                    <option value="ÎØºÏ£ºÏ†Å ÏùòÏÇ¨Í≤∞Ï†ï Îä•Î†•">ÎØºÏ£ºÏ†Å ÏùòÏÇ¨Í≤∞Ï†ï Îä•Î†•</option>
                    <option value="Ï∞ΩÏùòÏ†Å Î¨∏Ï†úÌï¥Í≤∞">Ï∞ΩÏùòÏ†Å Î¨∏Ï†úÌï¥Í≤∞</option>
                </select>
            </div>

            <button class="btn btn-full" id="recommend-btn" onclick="getTopicRecommendations()">
                ü§ñ AI Ï£ºÏ†ú Ï∂îÏ≤ú Î∞õÍ∏∞
            </button>
        </div>

        <!-- 2Îã®Í≥Ñ: Ï£ºÏ†ú ÏÑ†ÌÉù -->
        <div class="card hidden" id="topic-selection">
            <h2>üéØ 2Îã®Í≥Ñ: ÌÜ†Î°† Ï£ºÏ†ú ÏÑ†ÌÉù</h2>
            <p>AIÍ∞Ä Ï∂îÏ≤úÌïú Ï£ºÏ†ú Ï§ë ÌïòÎÇòÎ•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî:</p>
            <div id="topic-list"></div>
            
            <!-- Ïû¨Ï∂îÏ≤ú ÏÑπÏÖò -->
            <div class="card re-recommendation hidden" id="re-recommendation-section">
                <h2>üîÑ Îã§Î•∏ Ï£ºÏ†úÍ∞Ä ÌïÑÏöîÌïòÏã†Í∞ÄÏöî?</h2>
                <p>ÏïÑÎûò ÌîºÎìúÎ∞±ÏùÑ ÏÑ†ÌÉùÌïòÏãúÎ©¥ Îçî Ï†ÅÌï©Ìïú Ï£ºÏ†úÎ•º Ï∂îÏ≤úÌï¥ÎìúÎ¶ΩÎãàÎã§:</p>
                
                <div class="feedback-options">
                    <div class="feedback-option">
                        <input type="checkbox" name="feedback" value="Îçî Ïâ¨Ïö¥ Ï£ºÏ†ú" id="feedback-easy">
                        <label for="feedback-easy">Îçî Ïâ¨Ïö¥ Ï£ºÏ†ú</label>
                    </div>
                    <div class="feedback-option">
                        <input type="checkbox" name="feedback" value="Îçî Ïñ¥Î†§Ïö¥ Ï£ºÏ†ú" id="feedback-hard">
                        <label for="feedback-hard">Îçî Ïñ¥Î†§Ïö¥ Ï£ºÏ†ú</label>
                    </div>
                    <div class="feedback-option">
                        <input type="checkbox" name="feedback" value="Îçî Íµ¨Ï≤¥Ï†ÅÏù∏ Ï£ºÏ†ú" id="feedback-specific">
                        <label for="feedback-specific">Îçî Íµ¨Ï≤¥Ï†ÅÏù∏ Ï£ºÏ†ú</label>
                    </div>
                    <div class="feedback-option">
                        <input type="checkbox" name="feedback" value="Îçî ÏùºÎ∞òÏ†ÅÏù∏ Ï£ºÏ†ú" id="feedback-general">
                        <label for="feedback-general">Îçî ÏùºÎ∞òÏ†ÅÏù∏ Ï£ºÏ†ú</label>
                    </div>
                    <div class="feedback-option">
                        <input type="checkbox" name="feedback" value="ÌïôÍµêÏÉùÌôú Í¥ÄÎ†®" id="feedback-school">
                        <label for="feedback-school">ÌïôÍµêÏÉùÌôú Í¥ÄÎ†®</label>
                    </div>
                    <div class="feedback-option">
                        <input type="checkbox" name="feedback" value="ÏÇ¨ÌöåÎ¨∏Ï†ú Í¥ÄÎ†®" id="feedback-social">
                        <label for="feedback-social">ÏÇ¨ÌöåÎ¨∏Ï†ú Í¥ÄÎ†®</label>
                    </div>
                </div>
                
                <div class="input-group">
                    <label for="manual-feedback">Ï∂îÍ∞Ä ÏöîÏ≤≠ÏÇ¨Ìï≠ (ÏÑ†ÌÉùÏÇ¨Ìï≠)</label>
                    <textarea id="manual-feedback" rows="2" placeholder="Ïòà: Îçî Ìù•ÎØ∏Î°úÏö¥ Ï£ºÏ†ú, Ï≤¥ÌóòÌï† Ïàò ÏûàÎäî Ï£ºÏ†ú Îì±"></textarea>
                </div>
                
                <button class="btn btn-warning btn-full" id="re-recommend-btn" onclick="reRecommendTopics()">
                    üîÑ ÏÉàÎ°úÏö¥ Ï£ºÏ†ú Ï∂îÏ≤úÎ∞õÍ∏∞
                </button>
            </div>
        </div>

        <!-- 3Îã®Í≥Ñ: ÏãúÎÇòÎ¶¨Ïò§ ÏÉùÏÑ± ÏÑ§Ï†ï -->
        <div class="card hidden" id="scenario-generation">
            <h2>‚öôÔ∏è 3Îã®Í≥Ñ: ÏãúÎÇòÎ¶¨Ïò§ ÏÉùÏÑ± ÏÑ§Ï†ï</h2>
            
            <div class="input-group">
                <label for="grade">ÎåÄÏÉÅ ÌïôÎÖÑ</label>
                <select id="grade">
                    <option value="">ÌïôÎÖÑÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî</option>
                    <option value="1-2ÌïôÎÖÑ">1-2ÌïôÎÖÑ</option>
                    <option value="3-4ÌïôÎÖÑ">3-4ÌïôÎÖÑ</option>
                    <option value="5-6ÌïôÎÖÑ">5-6ÌïôÎÖÑ</option>
                    <option value="Ï†ÑÌïôÎÖÑ">Ï†ÑÌïôÎÖÑ</option>
                </select>
            </div>

            <div class="input-group">
                <label>Í¥ÄÎ†® ÍµêÍ≥º (Î≥µÏàòÏÑ†ÌÉù Í∞ÄÎä•)</label>
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="checkbox" name="subject" value="Íµ≠Ïñ¥" id="korean">
                        <label for="korean">Íµ≠Ïñ¥</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" name="subject" value="ÎèÑÎçï" id="ethics">
                        <label for="ethics">ÎèÑÎçï</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" name="subject" value="ÏÇ¨Ìöå" id="social">
                        <label for="social">ÏÇ¨Ìöå</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" name="subject" value="Í≥ºÌïô" id="science">
                        <label for="science">Í≥ºÌïô</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" name="subject" value="Ïã§Í≥º" id="practical">
                        <label for="practical">Ïã§Í≥º</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" name="subject" value="Ï∞ΩÏ≤¥" id="creative">
                        <label for="creative">Ï∞ΩÏ≤¥</label>
                    </div>
                </div>
            </div>

            <div class="input-group">
                <label for="time">ÏòàÏÉÅ ÏàòÏóÖÏãúÍ∞Ñ</label>
                <select id="time">
                    <option value="">ÏãúÍ∞ÑÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî</option>
                    <option value="40Î∂Ñ(1Ï∞®Ïãú)">40Î∂Ñ(1Ï∞®Ïãú)</option>
                    <option value="80Î∂Ñ(2Ï∞®Ïãú)">80Î∂Ñ(2Ï∞®Ïãú)</option>
                    <option value="120Î∂Ñ(3Ï∞®Ïãú)">120Î∂Ñ(3Ï∞®Ïãú)</option>
                </select>
            </div>

            <button class="btn btn-success btn-full" id="generate-btn" onclick="generateScenario()">
                ‚ú® ÌÜ†Î°† ÏãúÎÇòÎ¶¨Ïò§ ÏÉùÏÑ±ÌïòÍ∏∞
            </button>
        </div>

        <!-- 4Îã®Í≥Ñ: Í≤∞Í≥º ÌëúÏãú -->
        <div class="card hidden" id="result-section">
            <h2>üìã ÏÉùÏÑ±Îêú ÌÜ†Î°† ÏãúÎÇòÎ¶¨Ïò§</h2>
            <div id="scenario-result"></div>
            
            <div class="action-buttons">
                <button class="btn btn-success" onclick="saveScenario()">
                    üíæ ÏãúÎÇòÎ¶¨Ïò§ Ï†ÄÏû•
                </button>
                <button class="btn btn-secondary" onclick="printScenario()">
                    üñ®Ô∏è Ïù∏ÏáÑÌïòÍ∏∞
                </button>
                <button class="btn btn-warning" onclick="copyScenario()">
                    üìã Î≥µÏÇ¨ÌïòÍ∏∞
                </button>
                <button class="btn btn-primary" onclick="location.reload()">
                    üîÑ ÏÉà ÏãúÎÇòÎ¶¨Ïò§ ÎßåÎì§Í∏∞
                </button>
            </div>
        </div>
    </div>

    <script>
        // ===== AI ÌÜ†Î°† ÏãúÎÇòÎ¶¨Ïò§ ÏÉùÏÑ±Í∏∞ Î©îÏù∏ Î°úÏßÅ =====

        // Ï†ÑÏó≠ Î≥ÄÏàò
        let selectedTopic = null;
        let currentTopics = [];

        // ÌéòÏù¥ÏßÄ Ï¥àÍ∏∞Ìôî
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ AI ÌÜ†Î°† ÏãúÎÇòÎ¶¨Ïò§ ÏÉùÏÑ±Í∏∞ Ï¥àÍ∏∞Ìôî ÏôÑÎ£å');
            
            // ÌÇ§ÏõåÎìú ÏûÖÎ†• ÌïÑÎìúÏóê Ìè¨Ïª§Ïä§
            document.getElementById('keyword').focus();
            
            // Enter ÌÇ§Î°ú Îã§Ïùå Îã®Í≥Ñ ÏßÑÌñâ
            document.getElementById('keyword').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    getTopicRecommendations();
                }
            });
            
            showStatus('üéØ ÌÇ§ÏõåÎìúÎ•º ÏûÖÎ†•ÌïòÏó¨ AI ÌÜ†Î°† Ï£ºÏ†ú Ï∂îÏ≤úÏùÑ Î∞õÏïÑÎ≥¥ÏÑ∏Ïöî!', 'info');
        });

        // ===== ÏÉÅÌÉú Î©îÏãúÏßÄ ÌëúÏãú =====
        function showStatus(message, type = 'info') {
            const statusEl = document.getElementById('status-message');
            if (!statusEl) {
                console.warn('status-message element not found');
                return;
            }
            statusEl.textContent = message;
            statusEl.className = `status-message ${type}`;
            statusEl.classList.remove('hidden');
            
            if (type === 'success' || type === 'error') {
                setTimeout(() => {
                    statusEl.classList.add('hidden');
                }, 5000);
            }
        }

        // ===== ÏÑπÏÖò ÌëúÏãú =====
        function showSection(sectionId) {
            const section = document.getElementById(sectionId);
            if (section) {
                section.classList.remove('hidden');
                section.style.display = 'block';
            }
        }

        // ===== OpenAI API Ìò∏Ï∂ú (Îç∞Î™®Ïö© - Ïã§Ï†úÎ°úÎäî ÏïàÏ†ÑÌïú Î∞±ÏóîÎìú ÏÑúÎ≤ÑÏóêÏÑú Ï≤òÎ¶¨Ìï¥Ïïº Ìï®) =====
        async function callOpenAI(prompt) {
            // Ïã§Ï†ú Ïö¥ÏòÅÌôòÍ≤ΩÏóêÏÑúÎäî Î≥¥ÏïàÏùÑ ÏúÑÌï¥ Î∞±ÏóîÎìú APIÎ•º ÌÜµÌï¥ Ìò∏Ï∂úÌï¥Ïïº Ìï©ÎãàÎã§
            showStatus('‚ö†Ô∏è Îç∞Î™® Î™®Îìú: Ïã§Ï†ú AI Ïó∞ÎèôÏù¥ ÌïÑÏöîÌï©ÎãàÎã§', 'warning');
            
            // ÏûÑÏãú ÏùëÎãµ ÏÉùÏÑ± (Ïã§Ï†ú Íµ¨ÌòÑÏóêÏÑúÎäî Ïã§Ï†ú AI API Ìò∏Ï∂ú)
            return new Promise((resolve) => {
                setTimeout(() => {
                    if (prompt.includes('Ï£ºÏ†ú Ï∂îÏ≤ú')) {
                        resolve(`[
                            {
                                "title": "Ï¥àÎì±ÌïôÏÉùÏùò Ïä§ÎßàÌä∏Ìè∞ ÏÇ¨Ïö©ÏùÑ Í∏àÏßÄÌï¥Ïïº ÌïúÎã§",
                                "description": "Ïñ¥Î¶∞Ïù¥ Ïä§ÎßàÌä∏Ìè∞ ÏÇ¨Ïö©Ïùò Ïû•Îã®Ï†êÍ≥º Ï†ÅÏ†àÌïú Í∑úÏ†úÏóê ÎåÄÌïú ÌÜ†Î°†ÏúºÎ°ú, ÎîîÏßÄÌÑ∏ ÏãúÎåÄÏùò ÍµêÏú° Î∞©Ìñ•ÏùÑ Î™®ÏÉâÌï† Ïàò ÏûàÏäµÎãàÎã§.",
                                "proView": "ÏßëÏ§ëÎ†•Í≥º ÏÇ¨ÌöåÏÑ± Î∞úÎã¨ÏùÑ ÏúÑÌï¥ Ï†úÌïúÏù¥ ÌïÑÏöîÌï©ÎãàÎã§",
                                "conView": "Ï†ïÎ≥¥ Ï†ëÍ∑ºÍ≥º ÏÜåÌÜµÏùÑ ÏúÑÌï¥ Ï†ÅÏ†àÌïú ÏÇ¨Ïö©Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§"
                            },
                            {
                                "title": "ÏàòÏóÖ ÏãúÍ∞ÑÏóê Ïä§ÎßàÌä∏Ìè∞ÏùÑ ÍµêÏú° ÎèÑÍµ¨Î°ú ÌôúÏö©Ìï¥Ïïº ÌïúÎã§",
                                "description": "ÎîîÏßÄÌÑ∏ Í∏∞Í∏∞Ïùò ÍµêÏú°Ï†Å ÌôúÏö© Í∞ÄÎä•ÏÑ±Ïóê ÎåÄÌïú ÌÜ†Î°†ÏúºÎ°ú, Ï†ÑÌÜµÏ†Å ÍµêÏú°Í≥º ÎîîÏßÄÌÑ∏ ÍµêÏú°Ïùò Í∑†ÌòïÏùÑ Ï∞æÏùÑ Ïàò ÏûàÏäµÎãàÎã§.",
                                "proView": "Ìù•ÎØ∏Î°≠Í≥† Ìö®Í≥ºÏ†ÅÏù∏ ÌïôÏäµÏù¥ Í∞ÄÎä•Ìï©ÎãàÎã§",
                                "conView": "ÏàòÏóÖ ÏßëÏ§ëÎèÑÍ∞Ä Îñ®Ïñ¥ÏßÄÍ≥† ÏùòÏ°¥ÏÑ±Ïù¥ ÏÉùÍπÅÎãàÎã§"
                            },
                            {
                                "title": "Ïä§ÎßàÌä∏Ìè∞ ÏÇ¨Ïö© ÏãúÍ∞ÑÏùÑ ÌïòÎ£® 1ÏãúÍ∞ÑÏúºÎ°ú Ï†úÌïúÌï¥Ïïº ÌïúÎã§",
                                "description": "Í±¥Ï†ÑÌïú ÎîîÏßÄÌÑ∏ ÏäµÍ¥Ä ÌòïÏÑ±ÏùÑ ÏúÑÌïú ÏãúÍ∞Ñ Ï†úÌïúÏùò ÌïÑÏöîÏÑ±Ïóê ÎåÄÌïú ÌÜ†Î°†ÏúºÎ°ú, ÏûêÍ∏∞Ï°∞Ï†à Îä•Î†•ÏùÑ Í∏∞Î•º Ïàò ÏûàÏäµÎãàÎã§.",
                                "proView": "Í±¥Í∞ïÌïú ÏÉùÌôúÏäµÍ¥ÄÍ≥º Ïã§Ï†ú Ï≤¥ÌóòÏùÑ ÏúÑÌï¥ ÌïÑÏöîÌï©ÎãàÎã§",
                                "conView": "Í∞úÏù∏Ïùò ÏÉÅÌô©Ïóê Îî∞Îùº Ïú†Ïó∞ÌïòÍ≤å Ï°∞Ï†àÎêòÏñ¥Ïïº Ìï©ÎãàÎã§"
                            }
                        ]`);
                    } else {
                        resolve(`{
                            "title": "${selectedTopic}",
                            "topic": "${selectedTopic}",
                            "keywords": ["ÌÜ†Î°†", "ÍµêÏú°", "Ï¥àÎì±ÌïôÏÉù"],
                            "grade": "5-6ÌïôÎÖÑ",
                            "subject": ["ÎèÑÎçï", "ÏÇ¨Ìöå"],
                            "background": "Ïù¥ Ï£ºÏ†úÎäî ÌòÑÎåÄ ÏÇ¨ÌöåÏóêÏÑú Ï§ëÏöîÌïú Ïù¥ÏäàÎ°ú, ÌïôÏÉùÎì§Ïù¥ Îã§ÏñëÌïú Í¥ÄÏ†êÏóêÏÑú ÏÉùÍ∞ÅÌï¥Î≥º Ïàò ÏûàÎäî Ï£ºÏ†úÏûÖÎãàÎã§.",
                            "proArguments": ["Ï∞¨ÏÑ± ÎÖºÏ†ê 1", "Ï∞¨ÏÑ± ÎÖºÏ†ê 2", "Ï∞¨ÏÑ± ÎÖºÏ†ê 3"],
                            "conArguments": ["Î∞òÎåÄ ÎÖºÏ†ê 1", "Î∞òÎåÄ ÎÖºÏ†ê 2", "Î∞òÎåÄ ÎÖºÏ†ê 3"],
                            "teacherTips": "ÌïôÏÉùÎì§Ïù¥ ÏÑúÎ°úÏùò ÏùòÍ≤¨ÏùÑ Ï°¥Ï§ëÌïòÎ©∞ ÌÜ†Î°†Ìï† Ïàò ÏûàÎèÑÎ°ù Î∂ÑÏúÑÍ∏∞Î•º Ï°∞ÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî.",
                            "keyQuestions": ["ÏßàÎ¨∏ 1", "ÏßàÎ¨∏ 2", "ÏßàÎ¨∏ 3", "ÏßàÎ¨∏ 4", "ÏßàÎ¨∏ 5", "ÏßàÎ¨∏ 6", "ÏßàÎ¨∏ 7", "ÏßàÎ¨∏ 8"],
                            "expectedOutcomes": ["ÌïôÏäµÏÑ±Í≥º 1", "ÌïôÏäµÏÑ±Í≥º 2", "ÌïôÏäµÏÑ±Í≥º 3", "ÌïôÏäµÏÑ±Í≥º 4"],
                            "materials": ["Ï§ÄÎπÑÎ¨º 1", "Ï§ÄÎπÑÎ¨º 2", "Ï§ÄÎπÑÎ¨º 3"]
                        }`);
                    }
                }, 3000);
            });
        }

        // ===== 1Îã®Í≥Ñ: ÌÜ†Î°† Ï£ºÏ†ú Ï∂îÏ≤ú =====
        async function getTopicRecommendations() {
            const keyword = document.getElementById('keyword').value.trim();
            const selectedPurpose = document.getElementById('topic-purpose').value.trim();
            
            if (!keyword) {
                showStatus('ÌÇ§ÏõåÎìúÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.', 'error');
                return;
            }

            const recommendBtn = document.getElementById('recommend-btn');
            recommendBtn.disabled = true;
            showAIProgress('topic');

            try {
                const prompt = `ÌÇ§ÏõåÎìú: "${keyword}", Î™©Ï†Å: "${selectedPurpose}" - Ï¥àÎì±ÌïôÏÉùÏùÑ ÏúÑÌïú ÌÜ†Î°† Ï£ºÏ†ú 3Í∞ú Ï∂îÏ≤ú`;
                const response = await callOpenAI(prompt + ' Ï£ºÏ†ú Ï∂îÏ≤ú');
                
                const topics = parseTopicResponse(response, keyword);
                displayTopics(topics);
                hideAIProgress();
                recommendBtn.disabled = false;
                showStatus('AIÍ∞Ä ÌÜ†Î°† Ï£ºÏ†ú 3Í∞úÎ•º Ï∂îÏ≤úÌñàÏäµÎãàÎã§!', 'success');
                
            } catch (error) {
                console.error('Ï£ºÏ†ú Ï∂îÏ≤ú Ïò§Î•ò:', error);
                hideAIProgress();
                recommendBtn.disabled = false;
                showStatus('Ï£ºÏ†ú Ï∂îÏ≤ú Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§. Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.', 'error');
            }
        }

        // ===== JSON ÏùëÎãµ ÌååÏã± =====
        function parseTopicResponse(response, keyword) {
            try {
                let jsonStr = response.trim();
                
                if (jsonStr.includes('```')) {
                    const match = jsonStr.match(/```(?:json)?\s*(\[[\s\S]*?\])\s*```/);
                    if (match) {
                        jsonStr = match[1];
                    }
                }
                
                const topics = JSON.parse(jsonStr);
                
                if (Array.isArray(topics) && topics.length === 3) {
                    return topics;
                } else {
                    throw new Error('ÏûòÎ™ªÎêú JSON ÌòïÏãù');
                }
            } catch (error) {
                console.error('JSON ÌååÏã± Ïã§Ìå®:', error);
                // Í∏∞Î≥∏ Ï£ºÏ†ú Î∞òÌôò
                return [
                    { 
                        title: `${keyword}Ïóê ÎåÄÌïú Ïö∞Î¶¨ ÌïôÍµêÏùò ÏÉàÎ°úÏö¥ Í∑úÏπôÏùÑ ÎßåÎì§Ïñ¥Ïïº ÌïúÎã§`, 
                        description: `${keyword}ÏôÄ Í¥ÄÎ†®Îêú ÌïôÍµê Í∑úÏπô Ï†úÏ†ïÏùò ÌïÑÏöîÏÑ±Ïóê ÎåÄÌïú ÌÜ†Î°†ÏûÖÎãàÎã§.`,
                        proView: 'Î™ÖÌôïÌïú Í∑úÏπôÏù¥ ÏûàÏñ¥Ïïº Î™®ÎëêÍ∞Ä Ìé∏ÏïàÌï©ÎãàÎã§',
                        conView: 'ÎÑàÎ¨¥ ÎßéÏùÄ Í∑úÏπôÏùÄ ÏûêÏú†Î•º Ï†úÌïúÌï©ÎãàÎã§'
                    },
                    { 
                        title: `${keyword} ÍµêÏú°ÏùÑ ÏùòÎ¨¥ÌôîÌï¥Ïïº ÌïúÎã§`, 
                        description: `${keyword} Í¥ÄÎ†® ÍµêÏú°Ïùò ÌïÑÏöîÏÑ±Í≥º ÏùòÎ¨¥ÌôîÏóê ÎåÄÌïú ÌÜ†Î°†ÏûÖÎãàÎã§.`,
                        proView: 'Î™®Îì† ÌïôÏÉùÏù¥ Í∑†Îì±ÌïòÍ≤å Î∞∞Ïö∏ Í∏∞ÌöåÎ•º Í∞ÄÏ†∏Ïïº Ìï©ÎãàÎã§',
                        conView: 'Í∞úÏù∏Ïùò Í¥ÄÏã¨Í≥º ÏÑ†ÌÉùÏùÑ Ï°¥Ï§ëÌï¥Ïïº Ìï©ÎãàÎã§'
                    },
                    { 
                        title: `${keyword}Î≥¥Îã§ Îã§Î•∏ Í≤ÉÏù¥ Îçî Ï§ëÏöîÌïòÎã§`, 
                        description: `${keyword}Ïùò Ïö∞ÏÑ†ÏàúÏúÑÏôÄ Ï§ëÏöîÎèÑÏóê ÎåÄÌïú ÌÜ†Î°†ÏûÖÎãàÎã§.`,
                        proView: 'Îã§ÏñëÌïú Í∞ÄÏπòÎ•º Í∑†ÌòïÏûàÍ≤å Í≥†Î†§Ìï¥Ïïº Ìï©ÎãàÎã§',
                        conView: `${keyword}Í∞Ä ÌòÑÏû¨ Í∞ÄÏû• ÏãúÍ∏âÌïú Î¨∏Ï†úÏûÖÎãàÎã§`
                    }
                ];
            }
        }

        // ===== Ï£ºÏ†ú Ï∂îÏ≤ú ÌëúÏãú =====
        function displayTopics(topics) {
            const topicList = document.getElementById('topic-list');
            currentTopics = topics;
            
            let html = '';
            topics.forEach((topic, index) => {
                const hasProCon = topic.proView && topic.conView;
                
                html += `
                    <div class="topic-option" onclick="selectTopicOption(${index}, '${topic.title.replace(/'/g, "\\'")}')">
                        <div class="select-indicator"></div>
                        <h3>${topic.title}</h3>
                        <p class="topic-description">${topic.description || ''}</p>
                        ${hasProCon ? `
                            <div class="pro-con-preview">
                                <div class="pro-preview">
                                    <span class="pro-label">üëç Ï∞¨ÏÑ±</span>
                                    <span class="pro-text">${topic.proView}</span>
                                </div>
                                <div class="con-preview">
                                    <span class="con-label">üëé Î∞òÎåÄ</span>
                                    <span class="con-text">${topic.conView}</span>
                                </div>
                            </div>
                        ` : ''}
                    </div>
                `;
            });
            
            topicList.innerHTML = html;
            showSection('topic-selection');
            
            // Ïû¨Ï∂îÏ≤ú ÏÑπÏÖò ÌëúÏãú
            const reRecommendSection = document.getElementById('re-recommendation-section');
            if (reRecommendSection) {
                reRecommendSection.classList.remove('hidden');
                reRecommendSection.style.display = 'block';
                reRecommendSection.style.visibility = 'visible';
            }
            
            document.getElementById('topic-selection').scrollIntoView({ behavior: 'smooth' });
        }

        // ===== Ï£ºÏ†ú ÏÑ†ÌÉù =====
        function selectTopicOption(index, topicTitle) {
            // Ïù¥Ï†Ñ ÏÑ†ÌÉù Ï†úÍ±∞
            document.querySelectorAll('.topic-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            // ÌòÑÏû¨ ÏÑ†ÌÉù ÌëúÏãú
            const selectedOption = document.querySelectorAll('.topic-option')[index];
            selectedOption.classList.add('selected');
            
            // Ï†ÑÏó≠ Î≥ÄÏàòÏóê ÏÑ†ÌÉùÎêú Ï£ºÏ†ú Ï†ÄÏû•
            selectedTopic = currentTopics[index].title;
            
            // Ï£ºÏ†ú Ï∂îÏ≤ú Îã®Í≥ÑÏóêÏÑú ÏÑ†ÌÉùÌïú Î™©Ï†ÅÏùÑ ÏãúÎÇòÎ¶¨Ïò§ ÏÉùÏÑ± Îã®Í≥ÑÏóê ÏûêÎèô Î∞òÏòÅ
            const selectedTopicPurpose = document.getElementById('topic-purpose').value;
            if (selectedTopicPurpose) {
                const scenarioPurposeField = document.getElementById('purpose');
                if (scenarioPurposeField) {
                    scenarioPurposeField.value = selectedTopicPurpose;
                }
            }
            
            // ÏãúÎÇòÎ¶¨Ïò§ ÏÉùÏÑ± ÏÑπÏÖò ÌëúÏãú
            showSection('scenario-generation');
            document.getElementById('scenario-generation').scrollIntoView({ behavior: 'smooth' });
            
            let statusMessage = `"${topicTitle}" Ï£ºÏ†úÍ∞Ä ÏÑ†ÌÉùÎêòÏóàÏäµÎãàÎã§!`;
            if (selectedTopicPurpose) {
                statusMessage += ` (${selectedTopicPurpose} Î™©Ï†Å Î∞òÏòÅÎê®)`;
            }
            showStatus(statusMessage, 'success');
        }

        // ===== ÏãúÎÇòÎ¶¨Ïò§ ÏÉùÏÑ± =====
        async function generateScenario() {
            if (!selectedTopic) {
                showStatus('Î®ºÏ†Ä ÌÜ†Î°† Ï£ºÏ†úÎ•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.', 'error');
                return;
            }

            const grade = document.getElementById('grade').value;
            
            // Îã§Ï§ë ÏÑ†ÌÉùÎêú ÍµêÍ≥ºÎì§ ÏàòÏßë
            const selectedSubjects = Array.from(document.querySelectorAll('input[name="subject"]:checked'))
                .map(checkbox => checkbox.value);
            const subjectText = selectedSubjects.length > 0 ? selectedSubjects.join(', ') : '';
            
            const time = document.getElementById('time').value;
            // ÌÜ†Î°† Ï£ºÏ†ú Ï∂îÏ≤ú Îã®Í≥ÑÏóêÏÑú ÏÑ†ÌÉùÌïú Î™©Ï†Å ÏÇ¨Ïö©
            const topicPurposeField = document.getElementById('topic-purpose');
            const purpose = topicPurposeField ? topicPurposeField.value.trim() : '';

            const generateBtn = document.getElementById('generate-btn');
            generateBtn.disabled = true;
            showAIProgress('scenario');

            try {
                const prompt = `Îã§Ïùå Ï£ºÏ†úÏóê ÎåÄÌïú ÌÜ†Î°† ÏãúÎÇòÎ¶¨Ïò§Î•º ÎßåÎì§Ïñ¥Ï£ºÏÑ∏Ïöî: "${selectedTopic}"

${grade ? `ÎåÄÏÉÅ ÌïôÎÖÑ: ${grade}` : ''}
${subjectText ? `Í¥ÄÎ†® ÍµêÍ≥º: ${subjectText}` : ''}
${purpose ? `ÌÜ†Î°† Î™©Ï†Å: ${purpose}` : ''}`;

                const scenario = await callOpenAI(prompt);
                
                hideAIProgress();
                generateBtn.disabled = false;
                
                displayFormattedScenario(scenario);
                showStatus('ÌÜ†Î°† ÏãúÎÇòÎ¶¨Ïò§Í∞Ä ÏÉùÏÑ±ÎêòÏóàÏäµÎãàÎã§!', 'success');
                
            } catch (error) {
                console.error('ÏãúÎÇòÎ¶¨Ïò§ ÏÉùÏÑ± Ïò§Î•ò:', error);
                hideAIProgress();
                generateBtn.disabled = false;
                showStatus('ÏãúÎÇòÎ¶¨Ïò§ ÏÉùÏÑ± Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§. Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.', 'error');
            }
        }

        // ===== ÏãúÎÇòÎ¶¨Ïò§ ÌëúÏãú Ìï®Ïàò =====
        function displayFormattedScenario(scenario) {
            const container = document.getElementById('scenario-result');
            if (!container) {
                console.error('‚ùå scenario-result Ïª®ÌÖåÏù¥ÎÑàÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§');
                return;
            }
            
            const sections = parseScenario(scenario);
            
            let html = '';
            
            // ÌÜ†Î°† Ï†úÎ™© Î∞è Ï£ºÏ†ú ÏÑπÏÖò
            if (sections.title || sections.topic) {
                html += `
                    <div class="scenario-section topic-section">
                        <h2>${sections.title || sections.topic}</h2>
                        ${sections.topic && sections.title !== sections.topic ? `<p class="topic-detail">${sections.topic}</p>` : ''}
                    </div>
                `;
            }
            
            // Î©îÌÉÄÎç∞Ïù¥ÌÑ∞ (ÌïôÎÖÑ, ÍµêÍ≥º, ÌÇ§ÏõåÎìú)
            if (sections.grade || sections.subject.length > 0 || sections.keywords.length > 0) {
                html += `
                    <div class="scenario-section metadata-section">
                        <h3><span class="icon">üìã</span>ÌÜ†Î°† Ï†ïÎ≥¥</h3>
                        <div class="metadata-grid">
                            ${sections.grade ? `<div class="metadata-item"><strong>ÎåÄÏÉÅ ÌïôÎÖÑ:</strong> ${sections.grade}</div>` : ''}
                            ${sections.subject.length > 0 ? `<div class="metadata-item"><strong>Í¥ÄÎ†® ÍµêÍ≥º:</strong> ${sections.subject.join(', ')}</div>` : ''}
                            ${sections.keywords.length > 0 ? `<div class="metadata-item"><strong>ÌïµÏã¨ ÌÇ§ÏõåÎìú:</strong> ${sections.keywords.join(', ')}</div>` : ''}
                        </div>
                    </div>
                `;
            }
            
            // ÌÜ†Î°† Î∞∞Í≤Ω ÏÑπÏÖò
            if (sections.background) {
                html += `
                    <div class="scenario-section">
                        <h3><span class="icon">üìö</span>ÌÜ†Î°† Î∞∞Í≤Ω ÏÑ§Î™Ö</h3>
                        <div class="scenario-content">
                            <p>${sections.background}</p>
                        </div>
                    </div>
                `;
            }
            
            // Ï∞¨ÏÑ± vs Î∞òÎåÄ ÎÖºÏ†ê
            if (sections.proArguments.length > 0 || sections.conArguments.length > 0) {
                html += `
                    <div class="scenario-section">
                        <h3><span class="icon">‚öñÔ∏è</span>Ï£ºÏöî ÎÖºÏ†ê</h3>
                        <div class="pros-cons-container">
                            <div class="pros-box">
                                <h4>‚úÖ Ï∞¨ÏÑ± Ï∏° ÎÖºÍ±∞</h4>
                                <div class="scenario-content">
                                    ${sections.proArguments.length > 0 
                                        ? `<ul>${sections.proArguments.map(arg => `<li>${arg}</li>`).join('')}</ul>`
                                        : '<p>Ï∞¨ÏÑ± ÎÖºÏ†êÏùÑ Ï§ÄÎπÑ Ï§ëÏûÖÎãàÎã§.</p>'}
                                </div>
                            </div>
                            <div class="cons-box">
                                <h4>‚ùå Î∞òÎåÄ Ï∏° ÎÖºÍ±∞</h4>
                                <div class="scenario-content">
                                    ${sections.conArguments.length > 0 
                                        ? `<ul>${sections.conArguments.map(arg => `<li>${arg}</li>`).join('')}</ul>`
                                        : '<p>Î∞òÎåÄ ÎÖºÏ†êÏùÑ Ï§ÄÎπÑ Ï§ëÏûÖÎãàÎã§.</p>'}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // ÌïµÏã¨ ÏßàÎ¨∏Îì§
            if (sections.keyQuestions.length > 0) {
                const topicPurposeField = document.getElementById('topic-purpose');
                const purpose = topicPurposeField ? topicPurposeField.value.trim() : '';
                const purposeClass = getPurposeClass(purpose);
                
                html += `
                    <div class="scenario-section ${purposeClass}">
                        <h3><span class="icon">‚ùì</span>ÌïµÏã¨ ÏßàÎ¨∏Îì§ ${purpose ? `<span class="purpose-tag" data-purpose="${purpose}">${purpose}</span>` : ''}</h3>
                        <div class="scenario-content">
                            <ul class="key-questions-list">
                                ${sections.keyQuestions.map(question => `<li class="question-item">${question}</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                `;
            }
            
            // Í∏∞ÎåÄ ÌïôÏäµ ÏÑ±Í≥º
            if (sections.expectedOutcomes.length > 0) {
                html += `
                    <div class="scenario-section">
                        <h3><span class="icon">üéØ</span>Í∏∞ÎåÄ ÌïôÏäµ ÏÑ±Í≥º</h3>
                        <div class="scenario-content">
                            <ul class="outcomes-list">
                                ${sections.expectedOutcomes.map(outcome => `<li>${outcome}</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                `;
            }
            
            // Ï§ÄÎπÑÎ¨º (ÌÜ†Í∏Ä Î∞©Ïãù)
            if (sections.materials.length > 0) {
                const materialsId = 'materials-' + Math.random().toString(36).substr(2, 9);
                html += `
                    <div class="scenario-section">
                        <h3 class="materials-toggle" onclick="toggleMaterials('${materialsId}')" style="cursor: pointer; user-select: none;">
                            <span class="icon">üì¶</span>Ï§ÄÎπÑÎ¨º 
                            <span class="toggle-indicator" id="${materialsId}-indicator">‚ñº</span>
                        </h3>
                        <div class="scenario-content materials-content" id="${materialsId}" style="display: none;">
                            <ul class="materials-list">
                                ${sections.materials.map(material => `<li>${material}</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                `;
            }
            
            // ÍµêÏÇ¨ ÏßÄÎèÑ ÌåÅ
            if (sections.teacherTips) {
                const topicPurposeField = document.getElementById('topic-purpose');
                const purpose = topicPurposeField ? topicPurposeField.value.trim() : '';
                const purposeClass = getPurposeClass(purpose);
                
                html += `
                    <div class="scenario-section ${purposeClass}">
                        <h3><span class="icon">üë©‚Äçüè´</span>ÍµêÏÇ¨ ÏßÄÎèÑ ÌåÅ ${purpose ? `<span class="purpose-tag" data-purpose="${purpose}">${purpose}</span>` : ''}</h3>
                        <div class="scenario-content">
                            <div class="teacher-tips-content">
                                <p>${sections.teacherTips}</p>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            if (html.length === 0) {
                html = '<div class="scenario-section"><p>ÏãúÎÇòÎ¶¨Ïò§ ÌååÏã±Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.</p></div>';
            }
            
            container.innerHTML = html;
            
            // ÏãúÎÇòÎ¶¨Ïò§ ÏÉùÏÑ± ÏôÑÎ£å ÌõÑ ÏÑπÏÖò ÌëúÏãú
            showSection('result-section');
            setTimeout(() => {
                document.querySelector('.scenario-section').scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'start' 
                });
            }, 100);
        }

        // ===== JSON ÏãúÎÇòÎ¶¨Ïò§ ÌååÏã± Ìï®Ïàò =====
        function parseScenario(scenario) {
            // Í∏∞Î≥∏ Íµ¨Ï°∞Ï≤¥
            const sections = {
                title: '',
                topic: '',
                background: '',
                proArguments: [],
                conArguments: [],
                teacherTips: '',
                keyQuestions: [],
                expectedOutcomes: [],
                materials: [],
                grade: '',
                subject: [],
                keywords: []
            };
            
            if (!scenario) {
                return sections;
            }

            // JSON ÌååÏã± ÏãúÎèÑ
            try {
                let jsonData;
                
                // JSON ÌòïÏãùÏù∏ÏßÄ ÌôïÏù∏
                if (scenario.trim().startsWith('{')) {
                    jsonData = JSON.parse(scenario);
                } else {
                    // ÎßàÌÅ¨Îã§Ïö¥ ÏΩîÎìú Î∏îÎ°ùÏóêÏÑú JSON Ï∂îÏ∂ú
                    const jsonMatch = scenario.match(/```(?:json)?\s*(\{[\s\S]*?\})\s*```/);
                    if (jsonMatch) {
                        jsonData = JSON.parse(jsonMatch[1]);
                    } else {
                        // Îã®Ïàú JSON Í∞ùÏ≤¥ Ï∞æÍ∏∞
                        const jsonStart = scenario.indexOf('{');
                        const jsonEnd = scenario.lastIndexOf('}');
                        if (jsonStart !== -1 && jsonEnd !== -1 && jsonEnd > jsonStart) {
                            const jsonStr = scenario.substring(jsonStart, jsonEnd + 1);
                            jsonData = JSON.parse(jsonStr);
                        }
                    }
                }
                
                if (jsonData) {
                    // JSON Îç∞Ïù¥ÌÑ∞Î•º sections Íµ¨Ï°∞Ïóê Îß§Ìïë
                    sections.title = jsonData.title || '';
                    sections.topic = jsonData.topic || '';
                    sections.background = jsonData.background || '';
                    sections.proArguments = Array.isArray(jsonData.proArguments) ? jsonData.proArguments : [];
                    sections.conArguments = Array.isArray(jsonData.conArguments) ? jsonData.conArguments : [];
                    sections.teacherTips = jsonData.teacherTips || '';
                    sections.keyQuestions = Array.isArray(jsonData.keyQuestions) ? jsonData.keyQuestions : [];
                    sections.expectedOutcomes = Array.isArray(jsonData.expectedOutcomes) ? jsonData.expectedOutcomes : [];
                    sections.materials = Array.isArray(jsonData.materials) ? jsonData.materials : [];
                    sections.grade = jsonData.grade || '';
                    sections.subject = Array.isArray(jsonData.subject) ? jsonData.subject : [];
                    sections.keywords = Array.isArray(jsonData.keywords) ? jsonData.keywords : [];
                    
                    return sections;
                } else {
                    throw new Error('JSON Îç∞Ïù¥ÌÑ∞Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§');
                }
            } catch (e) {
                console.log('‚ö†Ô∏è JSON ÌååÏã± Ïã§Ìå®, ÏõêÎ≥∏ ÌÖçÏä§Ìä∏ Î∞òÌôò:', e.message);
                
                // Î†àÍ±∞Ïãú ÌÖçÏä§Ìä∏ ÌååÏã±ÏùÑ ÏúÑÌïú Í∏∞Î≥∏Í∞í Î∞òÌôò
                sections.topic = selectedTopic || 'ÌÜ†Î°† Ï£ºÏ†ú';
                sections.background = scenario.substring(0, 200) + '...';
                
                return sections;
            }
        }

        // ===== ÌÜ†Î°† Î™©Ï†ÅÎ≥Ñ Ïä§ÌÉÄÏùº ÌÅ¥ÎûòÏä§ =====
        function getPurposeClass(purpose) {
            if (!purpose) return '';
            
            const purposeMapping = {
                'ÎπÑÌåêÏ†Å': 'purpose-critical',
                'ÏùòÏÇ¨ÏÜåÌÜµ': 'purpose-communication', 
                'Ï∞ΩÏùòÏ†Å': 'purpose-creative',
                'ÎØºÏ£º': 'purpose-democratic',
                'Îã§ÏñëÌïú': 'purpose-perspective',
                'Í¥ÄÏ†ê': 'purpose-perspective'
            };
            
            // Î™©Ï†Å ÌÖçÏä§Ìä∏ÏóêÏÑú ÌÇ§ÏõåÎìú Ï∞æÍ∏∞
            for (const [keyword, className] of Object.entries(purposeMapping)) {
                if (purpose.includes(keyword)) {
                    return className;
                }
            }
            
            return 'purpose-general';
        }

        // ===== Ïû¨Ï∂îÏ≤ú ÏãúÏä§ÌÖú =====
        async function reRecommendTopics() {
            const keyword = document.getElementById('keyword').value.trim();
            
            if (!keyword) {
                showStatus('ÌÇ§ÏõåÎìúÎ•º Î®ºÏ†Ä ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.', 'error');
                return;
            }

            // ÌîºÎìúÎ∞± ÏàòÏßë
            const feedbackCheckboxes = document.querySelectorAll('input[name="feedback"]:checked');
            const manualFeedback = document.getElementById('manual-feedback').value.trim();
            
            const feedbackOptions = Array.from(feedbackCheckboxes).map(cb => cb.value);
            let feedbackText = '';
            
            if (feedbackOptions.length > 0) {
                feedbackText += `Îã§Ïùå ÌîºÎìúÎ∞±ÏùÑ Î∞òÏòÅÌï¥Ï£ºÏÑ∏Ïöî: ${feedbackOptions.join(', ')}. `;
            }
            
            if (manualFeedback) {
                feedbackText += `Ï∂îÍ∞Ä ÏöîÏ≤≠ÏÇ¨Ìï≠: ${manualFeedback}`;
            }
            
            if (!feedbackText) {
                feedbackText = 'Ïù¥Ï†Ñ Ï£ºÏ†úÎì§Í≥ºÎäî Îã§Î•∏ ÏÉàÎ°úÏö¥ Í¥ÄÏ†êÏùò Ï£ºÏ†úÎ•º Ï∂îÏ≤úÌï¥Ï£ºÏÑ∏Ïöî.';
            }

            const reRecommendBtn = document.getElementById('re-recommend-btn');
            reRecommendBtn.disabled = true;
            showAIProgress('re-recommend');

            try {
                const prompt = `ÌÇ§ÏõåÎìú: "${keyword}", ÌîºÎìúÎ∞±: ${feedbackText}, Ïù¥Ï†Ñ Ï£ºÏ†úÎì§: ${currentTopics.map(t => t.title).join(', ')} - Í∞úÏÑ†Îêú ÌÜ†Î°† Ï£ºÏ†ú 3Í∞ú Ïû¨Ï∂îÏ≤ú`;
                const response = await callOpenAI(prompt + ' Ï£ºÏ†ú Ï∂îÏ≤ú');

                const topics = parseTopicResponse(response, keyword);
                displayTopics(topics);
                hideAIProgress();
                reRecommendBtn.disabled = false;
                showStatus('ÌîºÎìúÎ∞±ÏùÑ Î∞òÏòÅÌïú ÏÉàÎ°úÏö¥ Ï£ºÏ†ú 3Í∞úÎ•º Ï∂îÏ≤úÌñàÏäµÎãàÎã§!', 'success');
                
                // ÌîºÎìúÎ∞± Ìèº Ï¥àÍ∏∞Ìôî
                document.querySelectorAll('input[name="feedback"]').forEach(cb => cb.checked = false);
                document.getElementById('manual-feedback').value = '';
                
            } catch (error) {
                console.error('Ïû¨Ï∂îÏ≤ú Ïò§Î•ò:', error);
                hideAIProgress();
                reRecommendBtn.disabled = false;
                showStatus('Ïû¨Ï∂îÏ≤ú Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§. Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.', 'error');
            }
        }

        // ===== Ï§ÄÎπÑÎ¨º ÌÜ†Í∏Ä =====
        function toggleMaterials(materialsId) {
            const content = document.getElementById(materialsId);
            const indicator = document.getElementById(materialsId + '-indicator');
            
            if (content.style.display === 'none') {
                content.style.display = 'block';
                indicator.textContent = '‚ñ≤';
                indicator.classList.add('rotated');
            } else {
                content.style.display = 'none';
                indicator.textContent = '‚ñº';
                indicator.classList.remove('rotated');
            }
        }

        // ===== ÏãúÎÇòÎ¶¨Ïò§ Ï†ÄÏû• =====
        function saveScenario() {
            const content = document.getElementById('scenario-result');
            if (!content || content.innerHTML.trim() === '') {
                showStatus('Ï†ÄÏû•Ìï† ÏãúÎÇòÎ¶¨Ïò§Í∞Ä ÏóÜÏäµÎãàÎã§.', 'error');
                return;
            }
            
            const title = selectedTopic || 'ÌÜ†Î°†_ÏãúÎÇòÎ¶¨Ïò§';
            const date = new Date().toISOString().split('T')[0];
            const filename = `${title}_${date}.html`;
            
            const htmlContent = `
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${title} - AI ÌÜ†Î°† ÏãúÎÇòÎ¶¨Ïò§</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; margin: 20px; line-height: 1.6; }
        .scenario-section { margin-bottom: 30px; padding: 20px; border-radius: 8px; }
        h2, h3 { color: #3b82f6; }
        .pros-cons-container { display: flex; gap: 20px; }
        .pros-box, .cons-box { flex: 1; padding: 15px; border-radius: 8px; }
        .pros-box { background: #f0fdf4; border-left: 4px solid #10b981; }
        .cons-box { background: #fef2f2; border-left: 4px solid #ef4444; }
        ul { padding-left: 20px; }
        @media print { body { margin: 10px; } }
    </style>
</head>
<body>
    <div class="header">
        <h1>üéØ AI ÌÜ†Î°† ÏãúÎÇòÎ¶¨Ïò§</h1>
        <p>ÏÉùÏÑ±Ïùº: ${new Date().toLocaleDateString('ko-KR')}</p>
    </div>
    <div class="content">
        ${content.innerHTML}
    </div>
</body>
</html>
            `;
            
            const blob = new Blob([htmlContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
            
            showStatus('ÏãúÎÇòÎ¶¨Ïò§Í∞Ä Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§!', 'success');
        }

        // ===== ÏãúÎÇòÎ¶¨Ïò§ Ïù∏ÏáÑ =====
        function printScenario() {
            const content = document.getElementById('scenario-result');
            if (!content || content.innerHTML.trim() === '') {
                showStatus('Ïù∏ÏáÑÌï† ÏãúÎÇòÎ¶¨Ïò§Í∞Ä ÏóÜÏäµÎãàÎã§.', 'error');
                return;
            }
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <!DOCTYPE html>
                <html lang="ko">
                <head>
                    <meta charset="UTF-8">
                    <title>${selectedTopic || 'ÌÜ†Î°† ÏãúÎÇòÎ¶¨Ïò§'} - Ïù∏ÏáÑ</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        h2, h3 { color: #2563eb; }
                        .pros-cons-container { display: flex; gap: 20px; }
                        .pros-box, .cons-box { flex: 1; }
                        ul { padding-left: 20px; }
                        @media print { body { margin: 10px; } }
                    </style>
                </head>
                <body>
                    ${content.innerHTML}
                </body>
                </html>
            `);
            
            printWindow.document.close();
            printWindow.print();
            showStatus('Ïù∏ÏáÑ Ï§ÄÎπÑÍ∞Ä ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§!', 'success');
        }

        // ===== ÏãúÎÇòÎ¶¨Ïò§ Î≥µÏÇ¨ =====
        function copyScenario() {
            const content = document.getElementById('scenario-result');
            if (!content || content.innerHTML.trim() === '') {
                showStatus('Î≥µÏÇ¨Ìï† ÏãúÎÇòÎ¶¨Ïò§Í∞Ä ÏóÜÏäµÎãàÎã§.', 'error');
                return;
            }
            
            const textContent = content.innerText;
            navigator.clipboard.writeText(textContent).then(() => {
                showStatus('ÏãúÎÇòÎ¶¨Ïò§Í∞Ä ÌÅ¥Î¶ΩÎ≥¥ÎìúÏóê Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§!', 'success');
            }).catch(() => {
                showStatus('Î≥µÏÇ¨Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.', 'error');
            });
        }

        // ===== AI ÏßÑÌñâÎ•† ÌåùÏóÖ Ìï®ÏàòÎì§ =====
        let aiProgressModal = null;
        let progressSteps = [];
        let currentStep = 0;
        let progressInterval = null;

        function showAIProgress(type = 'topic') {
            // ÏßÑÌñâ Îã®Í≥Ñ ÏÑ§Ï†ï
            if (type === 'topic') {
                progressSteps = [
                    { text: 'ÌÇ§ÏõåÎìú Î∂ÑÏÑù Ï§ë...', icon: 'üîç' },
                    { text: 'Ï£ºÏ†ú ÏïÑÏù¥ÎîîÏñ¥ ÏÉùÏÑ± Ï§ë...', icon: 'üí°' },
                    { text: 'ÍµêÏú°Ï†Å Ï†ÅÌï©ÏÑ± Í≤ÄÌÜ† Ï§ë...', icon: 'üìö' },
                    { text: 'Ï∞¨Î∞ò ÎÖºÏ†ê Íµ¨ÏÑ± Ï§ë...', icon: '‚öñÔ∏è' },
                    { text: 'ÏµúÏ¢Ö Ï£ºÏ†ú ÏôÑÏÑ± Ï§ë...', icon: '‚ú®' }
                ];
            } else if (type === 'scenario') {
                progressSteps = [
                    { text: 'Ï£ºÏ†ú Î∂ÑÏÑù Ï§ë...', icon: 'üéØ' },
                    { text: 'ÌÜ†Î°† Íµ¨Ï°∞ ÏÑ§Í≥Ñ Ï§ë...', icon: 'üèóÔ∏è' },
                    { text: 'ÎÖºÏ†ê ÏÉÅÏÑ∏Ìôî Ï§ë...', icon: 'üìù' },
                    { text: 'ÍµêÏú° ÏûêÎ£å Íµ¨ÏÑ± Ï§ë...', icon: 'üìö' },
                    { text: 'ÍµêÏÇ¨ Í∞ÄÏù¥Îìú ÏÉùÏÑ± Ï§ë...', icon: 'üë©‚Äçüè´' },
                    { text: 'ÏµúÏ¢Ö ÏãúÎÇòÎ¶¨Ïò§ ÏôÑÏÑ± Ï§ë...', icon: 'üéâ' }
                ];
            } else if (type === 're-recommend') {
                progressSteps = [
                    { text: 'ÌîºÎìúÎ∞± Î∂ÑÏÑù Ï§ë...', icon: 'üîÑ' },
                    { text: 'Ïù¥Ï†Ñ Ï£ºÏ†ú Í≤ÄÌÜ† Ï§ë...', icon: 'üìã' },
                    { text: 'ÏÉàÎ°úÏö¥ ÏïÑÏù¥ÎîîÏñ¥ ÏÉùÏÑ± Ï§ë...', icon: 'üí°' },
                    { text: 'Í∞úÏÑ†Îêú Ï£ºÏ†ú Íµ¨ÏÑ± Ï§ë...', icon: 'üéØ' },
                    { text: 'ÏµúÏ¢Ö Ï∂îÏ≤ú ÏôÑÏÑ± Ï§ë...', icon: '‚ú®' }
                ];
            }
            
            currentStep = 0;
            
            // ÌåùÏóÖ HTML ÏÉùÏÑ±
            const titles = {
                'topic': 'ÌÜ†Î°† Ï£ºÏ†úÎ•º ÏÉùÏÑ± Ï§ëÏûÖÎãàÎã§',
                'scenario': 'ÏãúÎÇòÎ¶¨Ïò§Î•º ÏÉùÏÑ± Ï§ëÏûÖÎãàÎã§',
                're-recommend': 'Í∞úÏÑ†Îêú Ï£ºÏ†úÎ•º Ï∂îÏ≤ú Ï§ëÏûÖÎãàÎã§'
            };
            
            const durations = {
                'topic': '10-15',
                'scenario': '20-30',
                're-recommend': '10-15'
            };
            
            const modalHTML = `
                <div class="ai-progress-overlay" id="ai-progress-overlay">
                    <div class="ai-progress-modal">
                        <div class="ai-progress-icon">ü§ñ</div>
                        <div class="ai-progress-title">${titles[type] || 'Ï≤òÎ¶¨ Ï§ëÏûÖÎãàÎã§'}</div>
                        <div class="ai-progress-subtitle">ÏïΩ ${durations[type] || '10-20'}Ï¥à ÏÜåÏöîÎê©ÎãàÎã§</div>
                        
                        <div class="ai-progress-bar-container">
                            <div class="ai-progress-bar" id="ai-progress-bar"></div>
                        </div>
                        
                        <div class="ai-progress-steps">
                            ${progressSteps.map((step, index) => `
                                <div class="ai-progress-step" id="progress-step-${index}">
                                    <span class="ai-progress-step-icon">${step.icon}</span>
                                    <span>${step.text}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
            
            // DOMÏóê Ï∂îÍ∞Ä
            document.body.insertAdjacentHTML('beforeend', modalHTML);
            aiProgressModal = document.getElementById('ai-progress-overlay');
            
            // ÏßÑÌñâÎ•† Ïï†ÎãàÎ©îÏù¥ÏÖò ÏãúÏûë
            startProgressAnimation();
        }

        function startProgressAnimation() {
            const progressBar = document.getElementById('ai-progress-bar');
            const totalSteps = progressSteps.length;
            const stepDuration = 2000; // Í∞Å Îã®Í≥ÑÎãπ 2Ï¥à
            
            progressInterval = setInterval(() => {
                // Ïù¥Ï†Ñ Îã®Í≥Ñ ÏôÑÎ£å ÌëúÏãú
                if (currentStep > 0) {
                    const prevStep = document.getElementById(`progress-step-${currentStep - 1}`);
                    if (prevStep) {
                        prevStep.classList.remove('active');
                        prevStep.classList.add('completed');
                        prevStep.querySelector('.ai-progress-step-icon').textContent = '‚úÖ';
                    }
                }
                
                // ÌòÑÏû¨ Îã®Í≥Ñ ÌôúÏÑ±Ìôî
                if (currentStep < totalSteps) {
                    const currentStepEl = document.getElementById(`progress-step-${currentStep}`);
                    if (currentStepEl) {
                        currentStepEl.classList.add('active');
                    }
                    
                    // ÏßÑÌñâÎ•† Î∞î ÏóÖÎç∞Ïù¥Ìä∏
                    const progress = ((currentStep + 1) / totalSteps) * 100;
                    if (progressBar) {
                        progressBar.style.width = `${progress}%`;
                    }
                    
                    currentStep++;
                } else {
                    // Î™®Îì† Îã®Í≥Ñ ÏôÑÎ£å
                    clearInterval(progressInterval);
                }
            }, stepDuration);
        }

        function hideAIProgress() {
            if (progressInterval) {
                clearInterval(progressInterval);
                progressInterval = null;
            }
            
            if (aiProgressModal) {
                aiProgressModal.style.animation = 'aiProgressSlideIn 0.3s ease-out reverse';
                setTimeout(() => {
                    if (aiProgressModal) {
                        aiProgressModal.remove();
                        aiProgressModal = null;
                    }
                }, 300);
            }
        }
    </script>
</body>
</html>