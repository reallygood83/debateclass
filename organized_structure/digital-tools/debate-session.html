<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>💬 실시간 토론 진행 도구 - SuperClaude Framework</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    
    <!-- Chart.js for Analytics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        /* ===== 기본 설정 (원본 프로그램 기반) ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* 원본 프로그램 색상 시스템 완전 적용 */
            --primary-color: #3b82f6;
            --primary-hover: #2563eb;
            --primary-light: #eff6ff;
            --secondary-color: #64748b;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --info-color: #0ea5e9;
            --bg-color: #f8fafc;
            --card-bg: #ffffff;
            --text-color: #1f2937;
            --text-light: #6b7280;
            --border-color: #e2e8f0;
            --border-light: #f1f5f9;
            --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            
            /* 고급 그라디언트 시스템 */
            --gradient-primary: linear-gradient(135deg, var(--primary-color), #1d4ed8);
            --gradient-success: linear-gradient(135deg, var(--success-color), #059669);
            --gradient-warning: linear-gradient(135deg, var(--warning-color), #d97706);
            --gradient-danger: linear-gradient(135deg, var(--danger-color), #dc2626);
            --gradient-bg: linear-gradient(135deg, #f0f9ff 0%, #e0e7ff 100%);
            --gradient-card: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%);
            
            /* 애니메이션 시스템 */
            --transition-fast: 0.15s ease;
            --transition-normal: 0.3s ease;
            --transition-slow: 0.5s ease;
            --transition-bounce: 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans KR', sans-serif;
            background: var(--gradient-bg);
            color: var(--text-color);
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* ===== 레이아웃 시스템 ===== */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
        }

        /* ===== 헤더 시스템 (원본 프로그램 스타일) ===== */
        .header {
            text-align: center;
            padding: 40px 20px;
            background: var(--gradient-primary);
            color: white;
            box-shadow: var(--shadow-lg);
            border-radius: 20px;
            margin-bottom: 40px;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 30% 20%, rgba(255,255,255,0.1) 0%, transparent 50%);
            pointer-events: none;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            position: relative;
            z-index: 1;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .header .version-tag {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
        }

        /* ===== 카드 시스템 ===== */
        .card {
            background: var(--gradient-card);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
            transition: var(--transition-normal);
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-primary);
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .card h2 {
            color: var(--primary-color);
            margin-bottom: 20px;
            font-size: 1.5rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card.highlight {
            background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
            border: 2px solid var(--info-color);
            animation: highlightPulse 2s infinite;
        }

        @keyframes highlightPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.005); }
        }

        /* ===== 고급 타이머 시스템 ===== */
        .timer-container {
            position: relative;
        }

        .timer-display {
            text-align: center;
            font-size: 4rem;
            font-weight: 900;
            color: var(--primary-color);
            margin: 30px 0;
            padding: 40px;
            background: var(--gradient-card);
            border-radius: 20px;
            border: 3px solid var(--border-color);
            position: relative;
            font-variant-numeric: tabular-nums;
            letter-spacing: 0.05em;
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
        }

        .timer-display.warning {
            color: var(--warning-color);
            animation: timerWarning 1s infinite;
        }

        .timer-display.danger {
            color: var(--danger-color);
            animation: timerDanger 0.5s infinite;
        }

        @keyframes timerWarning {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.02); opacity: 0.8; }
        }

        @keyframes timerDanger {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .timer-progress {
            width: 100%;
            height: 8px;
            background: var(--border-color);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .timer-progress-fill {
            height: 100%;
            background: var(--gradient-success);
            transition: width 1s linear;
            border-radius: 4px;
        }

        .timer-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .timer-settings {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .timer-preset {
            text-align: center;
        }

        .timer-preset select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            background: white;
            transition: var(--transition-normal);
        }

        .timer-preset select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        /* ===== 버튼 시스템 (원본 프로그램 수준) ===== */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition-bounce);
            text-decoration: none;
            position: relative;
            overflow: hidden;
            min-width: 120px;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: var(--transition-normal);
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow: var(--shadow-lg);
        }

        .btn:active {
            transform: translateY(0) scale(0.98);
            transition: var(--transition-fast);
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: white;
        }

        .btn-success {
            background: var(--gradient-success);
            color: white;
        }

        .btn-warning {
            background: var(--gradient-warning);
            color: white;
        }

        .btn-danger {
            background: var(--gradient-danger);
            color: white;
        }

        .btn-outline {
            background: transparent;
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
        }

        .btn-outline:hover {
            background: var(--primary-color);
            color: white;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        /* ===== 토론 단계 시스템 ===== */
        .debate-stages {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stage-card {
            background: white;
            border-radius: 16px;
            padding: 25px;
            border: 2px solid var(--border-color);
            transition: var(--transition-normal);
            position: relative;
            cursor: pointer;
        }

        .stage-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--border-color);
            transition: var(--transition-normal);
        }

        .stage-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary-color);
        }

        .stage-card:hover::before {
            background: var(--primary-color);
            width: 6px;
        }

        .stage-card.active {
            background: var(--primary-light);
            border-color: var(--primary-color);
            box-shadow: var(--shadow-lg);
            animation: stageActive 1s ease;
        }

        .stage-card.active::before {
            background: var(--primary-color);
            width: 6px;
        }

        .stage-card.completed {
            background: linear-gradient(135deg, #ecfdf5, #d1fae5);
            border-color: var(--success-color);
        }

        .stage-card.completed::before {
            background: var(--success-color);
        }

        @keyframes stageActive {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }

        .stage-card h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 1.2rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .stage-card.active h3 {
            color: var(--primary-color);
        }

        .stage-card.completed h3 {
            color: var(--success-color);
        }

        .stage-description {
            color: var(--text-light);
            margin-bottom: 10px;
            line-height: 1.5;
        }

        .stage-time {
            font-size: 0.9rem;
            color: var(--text-light);
            font-weight: 500;
        }

        .stage-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
        }

        /* ===== 참가자 관리 시스템 ===== */
        .participants {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .team-section {
            background: white;
            border-radius: 16px;
            padding: 25px;
            border: 3px solid var(--border-color);
            position: relative;
            transition: var(--transition-normal);
        }

        .team-pro {
            border-color: var(--success-color);
            background: linear-gradient(135deg, #ecfdf5 0%, #f0fdf4 100%);
        }

        .team-con {
            border-color: var(--danger-color);
            background: linear-gradient(135deg, #fef2f2 0%, #fef5f5 100%);
        }

        .team-title {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            position: relative;
        }

        .team-pro .team-title { 
            color: var(--success-color); 
        }

        .team-con .team-title { 
            color: var(--danger-color); 
        }

        .participant-list {
            list-style: none;
            margin-bottom: 20px;
        }

        .participant-item {
            padding: 15px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 12px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: var(--transition-normal);
            cursor: pointer;
        }

        .participant-item:hover {
            background: rgba(255, 255, 255, 0.95);
            transform: translateX(3px);
        }

        .participant-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .speaking-indicator {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--border-color);
            transition: var(--transition-normal);
            position: relative;
        }

        .speaking-indicator.active {
            background: var(--success-color);
            animation: pulse 2s infinite;
        }

        .speaking-indicator.active::after {
            content: '';
            position: absolute;
            top: -3px;
            left: -3px;
            right: -3px;
            bottom: -3px;
            border: 2px solid var(--success-color);
            border-radius: 50%;
            opacity: 0.3;
            animation: ripple 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.2); }
        }

        @keyframes ripple {
            0% { transform: scale(0.8); opacity: 0.8; }
            100% { transform: scale(1.5); opacity: 0; }
        }

        .participant-name {
            font-weight: 600;
            color: var(--text-color);
        }

        .participant-role {
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .participant-controls {
            display: flex;
            gap: 8px;
        }

        .control-btn {
            padding: 8px;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.8);
            cursor: pointer;
            transition: var(--transition-normal);
        }

        .control-btn:hover {
            background: rgba(255, 255, 255, 1);
            transform: scale(1.1);
        }

        /* ===== 의견 기록 시스템 ===== */
        .opinion-input {
            width: 100%;
            padding: 15px;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            font-size: 1rem;
            line-height: 1.5;
            resize: vertical;
            min-height: 120px;
            transition: var(--transition-normal);
            font-family: inherit;
        }

        .opinion-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .opinion-input::placeholder {
            color: var(--text-light);
        }

        /* ===== 통계 및 분석 시스템 ===== */
        .analytics-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            border: 2px solid var(--border-color);
            transition: var(--transition-normal);
        }

        .stat-card:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .stat-label {
            color: var(--text-light);
            font-weight: 500;
        }

        /* ===== AI 분석 섹션 ===== */
        .ai-analysis {
            background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
            border: 2px solid var(--info-color);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 30px;
            position: relative;
        }

        .ai-analysis h3 {
            color: var(--info-color);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .ai-insight {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid var(--info-color);
        }

        /* ===== 로딩 및 상태 시스템 ===== */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition-normal);
        }

        .loading-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .loading-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 400px;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid var(--border-color);
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ===== 상태 메시지 시스템 ===== */
        .status-message {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 24px;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            box-shadow: var(--shadow-lg);
            z-index: 9999;
            transform: translateX(400px);
            transition: var(--transition-normal);
            max-width: 400px;
        }

        .status-message.show {
            transform: translateX(0);
        }

        .status-message.success {
            background: var(--gradient-success);
        }

        .status-message.error {
            background: var(--gradient-danger);
        }

        .status-message.info {
            background: var(--gradient-primary);
        }

        /* ===== 플로팅 도움말 ===== */
        .floating-help {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: var(--gradient-primary);
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            transition: var(--transition-bounce);
        }

        .floating-help:hover {
            transform: scale(1.1);
            box-shadow: var(--shadow-xl);
        }

        /* ===== 반응형 디자인 ===== */
        @media (max-width: 1200px) {
            .container {
                max-width: 100%;
                padding: 15px;
            }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
                flex-direction: column;
                gap: 10px;
            }
            
            .participants {
                grid-template-columns: 1fr;
            }
            
            .timer-display {
                font-size: 2.5rem;
                padding: 20px;
            }

            .debate-stages {
                grid-template-columns: 1fr;
            }

            .timer-settings {
                grid-template-columns: 1fr;
            }

            .analytics-section {
                grid-template-columns: 1fr;
            }

            .btn {
                min-width: auto;
                width: 100%;
                margin-bottom: 10px;
            }

            .timer-controls {
                flex-direction: column;
            }

            .stage-controls {
                flex-direction: column;
            }
        }

        /* ===== 접근성 개선 ===== */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* ===== 다크모드 준비 ===== */
        @media (prefers-color-scheme: dark) {
            :root {
                --bg-color: #0f172a;
                --card-bg: #1e293b;
                --text-color: #f1f5f9;
                --text-light: #94a3b8;
                --border-color: #334155;
            }
        }

        /* ===== 인쇄 최적화 ===== */
        @media print {
            .floating-help,
            .timer-controls,
            .stage-controls {
                display: none !important;
            }
            
            .card {
                break-inside: avoid;
                box-shadow: none;
                border: 1px solid #ddd;
            }
        }

        /* ===== 고급 효과들 ===== */
        .glass-effect {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.8);
        }

        .neon-glow {
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
        }

        .slide-up {
            animation: slideUp 0.6s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in {
            animation: fadeIn 0.8s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>
<body>
    <!-- 로딩 오버레이 -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <h3>AI 분석 중...</h3>
            <p>토론 세션을 준비하고 있습니다</p>
        </div>
    </div>

    <!-- 상태 메시지 -->
    <div class="status-message" id="statusMessage"></div>

    <div class="container">
        <!-- 헤더 -->
        <div class="header slide-up">
            <div class="version-tag">v2.0 Enhanced</div>
            <h1>
                <span>💬</span>
                실시간 토론 진행 도구
            </h1>
            <p>AI 기반 체계적 토론 진행 시스템</p>
        </div>

        <!-- 세션 설정 -->
        <div class="card slide-up">
            <h2>🎯 토론 세션 설정</h2>
            <div class="timer-settings">
                <div class="timer-preset">
                    <label><strong>토론 주제</strong></label>
                    <input type="text" id="debateTopicInput" placeholder="토론 주제를 입력하세요" 
                           style="width: 100%; padding: 12px; border: 2px solid var(--border-color); border-radius: 8px; margin-top: 8px;">
                </div>
                <div class="timer-preset">
                    <label><strong>참가자 수</strong></label>
                    <select id="participantCount" onchange="updateParticipants()">
                        <option value="6">6명 (팀당 3명)</option>
                        <option value="8">8명 (팀당 4명)</option>
                        <option value="10">10명 (팀당 5명)</option>
                        <option value="12">12명 (팀당 6명)</option>
                    </select>
                </div>
                <div class="timer-preset">
                    <label><strong>토론 형식</strong></label>
                    <select id="debateFormat">
                        <option value="structured">구조화된 토론</option>
                        <option value="oxford">옥스포드 토론</option>
                        <option value="parliamentary">의회식 토론</option>
                        <option value="fishbowl">어항식 토론</option>
                    </select>
                </div>
            </div>
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn btn-primary" onclick="startDebateSession()">🚀 토론 세션 시작</button>
                <button class="btn btn-outline" onclick="generateDebateQuestions()">🤖 AI 질문 생성</button>
            </div>
        </div>

        <!-- 타이머 및 진행 상황 -->
        <div class="card highlight" id="timerCard">
            <h2>⏰ 토론 타이머 & 진행 상황</h2>
            <div class="timer-container">
                <div class="timer-progress">
                    <div class="timer-progress-fill" id="timerProgress" style="width: 100%;"></div>
                </div>
                <div class="timer-display" id="timerDisplay">05:00</div>
                <div class="timer-controls">
                    <button class="btn btn-success" id="startBtn" onclick="startTimer()">
                        <span class="material-symbols-outlined">play_arrow</span>
                        시작
                    </button>
                    <button class="btn btn-warning" id="pauseBtn" onclick="pauseTimer()">
                        <span class="material-symbols-outlined">pause</span>
                        일시정지
                    </button>
                    <button class="btn btn-danger" id="stopBtn" onclick="stopTimer()">
                        <span class="material-symbols-outlined">stop</span>
                        정지
                    </button>
                    <button class="btn btn-outline" onclick="resetTimer()">
                        <span class="material-symbols-outlined">refresh</span>
                        리셋
                    </button>
                </div>
                <div class="timer-settings">
                    <div class="timer-preset">
                        <label><strong>현재 단계 시간</strong></label>
                        <select id="timeSelect" onchange="setTimer()">
                            <option value="300">5분 (도입)</option>
                            <option value="600">10분 (준비/분석)</option>
                            <option value="900">15분 (본 토론)</option>
                            <option value="1200">20분 (심화 토론)</option>
                            <option value="1800">30분 (종합 토론)</option>
                        </select>
                    </div>
                    <div class="timer-preset">
                        <label><strong>알림 설정</strong></label>
                        <select id="alertSettings">
                            <option value="60">1분 전 알림</option>
                            <option value="120">2분 전 알림</option>
                            <option value="180">3분 전 알림</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- 토론 단계 진행 -->
        <div class="card">
            <h2>📋 토론 진행 단계</h2>
            <div class="debate-stages">
                <div class="stage-card active" id="stage1" onclick="selectStage(1)">
                    <h3><span class="material-symbols-outlined">rocket_launch</span> 1단계: 도입</h3>
                    <p class="stage-description">주제 소개, 팀 구성, 규칙 설명</p>
                    <div class="stage-time">⏱️ 권장 시간: 5분</div>
                </div>
                <div class="stage-card" id="stage2" onclick="selectStage(2)">
                    <h3><span class="material-symbols-outlined">search</span> 2단계: 자료 분석</h3>
                    <p class="stage-description">관련 자료 검토 및 근거 수집</p>
                    <div class="stage-time">⏱️ 권장 시간: 10분</div>
                </div>
                <div class="stage-card" id="stage3" onclick="selectStage(3)">
                    <h3><span class="material-symbols-outlined">psychology</span> 3단계: 토론 준비</h3>
                    <p class="stage-description">팀별 입장 정리 및 전략 수립</p>
                    <div class="stage-time">⏱️ 권장 시간: 10분</div>
                </div>
                <div class="stage-card" id="stage4" onclick="selectStage(4)">
                    <h3><span class="material-symbols-outlined">forum</span> 4단계: 본 토론</h3>
                    <p class="stage-description">의견 발표 및 상호 토론</p>
                    <div class="stage-time">⏱️ 권장 시간: 15-20분</div>
                </div>
                <div class="stage-card" id="stage5" onclick="selectStage(5)">
                    <h3><span class="material-symbols-outlined">summarize</span> 5단계: 정리</h3>
                    <p class="stage-description">토론 내용 정리 및 성찰</p>
                    <div class="stage-time">⏱️ 권장 시간: 5분</div>
                </div>
            </div>
            <div class="stage-controls">
                <button class="btn btn-primary" onclick="nextStage()">
                    <span class="material-symbols-outlined">arrow_forward</span>
                    다음 단계
                </button>
                <button class="btn btn-outline" onclick="prevStage()">
                    <span class="material-symbols-outlined">arrow_back</span>
                    이전 단계
                </button>
                <button class="btn btn-success" onclick="completeStage()">
                    <span class="material-symbols-outlined">check_circle</span>
                    단계 완료
                </button>
            </div>
        </div>

        <!-- 참가자 관리 -->
        <div class="card">
            <h2>👥 참가자 관리</h2>
            <div class="participants">
                <div class="team-section team-pro">
                    <div class="team-title">
                        <span class="material-symbols-outlined">thumb_up</span>
                        찬성팀 (PRO)
                    </div>
                    <ul class="participant-list" id="proTeam">
                        <!-- JavaScript로 동적 생성 -->
                    </ul>
                    <div style="margin-bottom: 15px;">
                        <button class="btn btn-success" onclick="selectSpeaker('pro')">
                            <span class="material-symbols-outlined">mic</span>
                            발언자 선택
                        </button>
                        <button class="btn btn-outline" onclick="addParticipant('pro')">
                            <span class="material-symbols-outlined">person_add</span>
                            참가자 추가
                        </button>
                    </div>
                    <textarea class="opinion-input" id="proOpinions" 
                              placeholder="찬성팀 주요 의견과 근거를 실시간으로 기록하세요...&#10;&#10;예시:&#10;- 주요 논점 1: 구체적 근거&#10;- 주요 논점 2: 사례와 데이터&#10;- 반박 내용: 상대방 의견에 대한 반박"></textarea>
                </div>

                <div class="team-section team-con">
                    <div class="team-title">
                        <span class="material-symbols-outlined">thumb_down</span>
                        반대팀 (CON)
                    </div>
                    <ul class="participant-list" id="conTeam">
                        <!-- JavaScript로 동적 생성 -->
                    </ul>
                    <div style="margin-bottom: 15px;">
                        <button class="btn btn-danger" onclick="selectSpeaker('con')">
                            <span class="material-symbols-outlined">mic</span>
                            발언자 선택
                        </button>
                        <button class="btn btn-outline" onclick="addParticipant('con')">
                            <span class="material-symbols-outlined">person_add</span>
                            참가자 추가
                        </button>
                    </div>
                    <textarea class="opinion-input" id="conOpinions" 
                              placeholder="반대팀 주요 의견과 근거를 실시간으로 기록하세요...&#10;&#10;예시:&#10;- 주요 논점 1: 구체적 근거&#10;- 주요 논점 2: 사례와 데이터&#10;- 반박 내용: 상대방 의견에 대한 반박"></textarea>
                </div>
            </div>
        </div>

        <!-- AI 분석 섹션 -->
        <div class="ai-analysis">
            <h3>
                <span class="material-symbols-outlined">psychology</span>
                AI 토론 분석
            </h3>
            <div class="ai-insight" id="aiInsights">
                <p><strong>실시간 분석 대기중...</strong></p>
                <p>토론이 진행되면 AI가 다음을 분석합니다:</p>
                <ul>
                    <li>각 팀의 논리적 구조 평가</li>
                    <li>근거의 타당성 분석</li>
                    <li>토론 균형도 측정</li>
                    <li>개선 제안사항 제공</li>
                </ul>
            </div>
            <button class="btn btn-primary" onclick="analyzeDebate()">
                <span class="material-symbols-outlined">analytics</span>
                AI 분석 실행
            </button>
        </div>

        <!-- 토론 통계 -->
        <div class="card">
            <h2>📊 토론 통계</h2>
            <div class="analytics-section">
                <div class="stat-card">
                    <div class="stat-value" id="totalTime">00:00</div>
                    <div class="stat-label">총 토론 시간</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="currentStage">1</div>
                    <div class="stat-label">현재 단계</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="activeSpeakers">0</div>
                    <div class="stat-label">활성 발언자</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="balanceScore">-</div>
                    <div class="stat-label">토론 균형도</div>
                </div>
            </div>
            <div style="margin-top: 20px;">
                <canvas id="debateChart" style="max-height: 400px;"></canvas>
            </div>
        </div>

        <!-- 토론 결과 및 저장 -->
        <div class="card">
            <h2>💾 토론 결과 관리</h2>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                <button class="btn btn-success" onclick="saveResults()">
                    <span class="material-symbols-outlined">save</span>
                    결과 저장
                </button>
                <button class="btn btn-primary" onclick="generateReport()">
                    <span class="material-symbols-outlined">description</span>
                    리포트 생성
                </button>
                <button class="btn btn-warning" onclick="printResults()">
                    <span class="material-symbols-outlined">print</span>
                    인쇄하기
                </button>
                <button class="btn btn-outline" onclick="exportResults()">
                    <span class="material-symbols-outlined">download</span>
                    내보내기
                </button>
                <button class="btn btn-outline" onclick="shareResults()">
                    <span class="material-symbols-outlined">share</span>
                    공유하기
                </button>
            </div>
        </div>
    </div>

    <!-- 플로팅 도움말 버튼 -->
    <button class="floating-help" onclick="showHelp()" title="사용자 매뉴얼">
        <span class="material-symbols-outlined">help</span>
    </button>

    <script>
        // ===== 전역 변수 (원본 프로그램 수준) =====
        let timerInterval;
        let timeLeft = 300; // 기본 5분
        let totalTime = 300;
        let currentStage = 1;
        let isTimerRunning = false;
        let isPaused = false;
        let speakers = { pro: [], con: [] };
        let participants = { pro: [], con: [] };
        let debateData = {
            topic: '',
            startTime: null,
            stages: [],
            opinions: { pro: '', con: '' },
            analytics: {}
        };
        let chart = null;

        // ===== 초기화 함수 =====
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🎉 토론 진행 도구 초기화 중...');
            initializeParticipants();
            updateTimerDisplay();
            initializeChart();
            loadSavedData();
            
            // 애니메이션 효과 적용
            setTimeout(() => {
                document.querySelectorAll('.slide-up').forEach((el, index) => {
                    setTimeout(() => {
                        el.style.opacity = '1';
                        el.style.transform = 'translateY(0)';
                    }, index * 200);
                });
            }, 100);
            
            showStatus('토론 진행 도구가 준비되었습니다!', 'success');
        });

        // ===== 참가자 관리 시스템 =====
        function initializeParticipants() {
            const count = parseInt(document.getElementById('participantCount').value);
            const perTeam = count / 2;
            
            participants.pro = [];
            participants.con = [];
            
            // 기본 참가자 생성
            for (let i = 0; i < perTeam; i++) {
                participants.pro.push({
                    name: `참가자 ${i + 1}`,
                    role: i === 0 ? '팀장' : '팀원',
                    speaking: false,
                    speakTime: 0
                });
                
                participants.con.push({
                    name: `참가자 ${i + 1}`,
                    role: i === 0 ? '팀장' : '팀원',
                    speaking: false,
                    speakTime: 0
                });
            }
            
            updateParticipantDisplay();
        }

        function updateParticipants() {
            initializeParticipants();
        }

        function updateParticipantDisplay() {
            updateTeamDisplay('pro', participants.pro);
            updateTeamDisplay('con', participants.con);
        }

        function updateTeamDisplay(team, teamParticipants) {
            const container = document.getElementById(`${team}Team`);
            container.innerHTML = '';
            
            teamParticipants.forEach((participant, index) => {
                const listItem = document.createElement('li');
                listItem.className = 'participant-item';
                listItem.innerHTML = `
                    <div class="participant-info">
                        <div class="speaking-indicator ${participant.speaking ? 'active' : ''}" 
                             id="${team}Speaker${index}"></div>
                        <div>
                            <div class="participant-name" contenteditable="true" 
                                 onblur="updateParticipantName('${team}', ${index}, this.textContent)">${participant.name}</div>
                            <div class="participant-role">${participant.role}</div>
                        </div>
                    </div>
                    <div class="participant-controls">
                        <button class="control-btn" onclick="toggleSpeaking('${team}', ${index})" title="발언 토글">
                            <span class="material-symbols-outlined">mic</span>
                        </button>
                        <button class="control-btn" onclick="removeParticipant('${team}', ${index})" title="참가자 제거">
                            <span class="material-symbols-outlined">person_remove</span>
                        </button>
                    </div>
                `;
                container.appendChild(listItem);
            });
        }

        function updateParticipantName(team, index, newName) {
            participants[team][index].name = newName.trim() || `참가자 ${index + 1}`;
            saveDebateData();
        }

        function addParticipant(team) {
            const name = prompt(`새 ${team === 'pro' ? '찬성' : '반대'}팀 참가자 이름을 입력하세요:`);
            if (name && name.trim()) {
                participants[team].push({
                    name: name.trim(),
                    role: '팀원',
                    speaking: false,
                    speakTime: 0
                });
                updateParticipantDisplay();
                saveDebateData();
                showStatus(`${name}이(가) ${team === 'pro' ? '찬성' : '반대'}팀에 추가되었습니다.`, 'success');
            }
        }

        function removeParticipant(team, index) {
            if (participants[team].length > 1) {
                const participant = participants[team][index];
                if (confirm(`${participant.name}을(를) 팀에서 제거하시겠습니까?`)) {
                    participants[team].splice(index, 1);
                    updateParticipantDisplay();
                    saveDebateData();
                    showStatus(`${participant.name}이(가) 제거되었습니다.`, 'info');
                }
            } else {
                showStatus('최소 1명의 참가자가 필요합니다.', 'error');
            }
        }

        function selectSpeaker(team) {
            const teamParticipants = participants[team];
            let options = teamParticipants.map((p, i) => `${i}: ${p.name} (${p.role})`).join('\n');
            const selection = prompt(`발언자를 선택하세요 (번호 입력):\n${options}`);
            
            if (selection !== null && selection !== '') {
                const index = parseInt(selection);
                if (index >= 0 && index < teamParticipants.length) {
                    toggleSpeaking(team, index);
                } else {
                    showStatus('잘못된 번호입니다.', 'error');
                }
            }
        }

        function toggleSpeaking(team, index) {
            // 다른 발언자들 비활성화
            participants[team].forEach((p, i) => {
                if (i !== index) p.speaking = false;
            });
            
            // 선택된 발언자 토글
            participants[team][index].speaking = !participants[team][index].speaking;
            
            updateParticipantDisplay();
            updateSpeakerCount();
            
            const participant = participants[team][index];
            const status = participant.speaking ? '발언 시작' : '발언 종료';
            showStatus(`${participant.name}: ${status}`, 'info');
        }

        function updateSpeakerCount() {
            const activeCount = [...participants.pro, ...participants.con]
                .filter(p => p.speaking).length;
            document.getElementById('activeSpeakers').textContent = activeCount;
        }

        // ===== 타이머 시스템 =====
        function startTimer() {
            if (!isTimerRunning && timeLeft > 0) {
                isTimerRunning = true;
                isPaused = false;
                timerInterval = setInterval(updateTimer, 1000);
                updateTimerButtons();
                recordStageStart();
                showStatus('타이머가 시작되었습니다.', 'success');
            }
        }

        function pauseTimer() {
            if (isTimerRunning) {
                clearInterval(timerInterval);
                isTimerRunning = false;
                isPaused = true;
                updateTimerButtons();
                showStatus('타이머가 일시정지되었습니다.', 'warning');
            }
        }

        function stopTimer() {
            clearInterval(timerInterval);
            isTimerRunning = false;
            isPaused = false;
            timeLeft = parseInt(document.getElementById('timeSelect').value);
            totalTime = timeLeft;
            updateTimerDisplay();
            updateTimerButtons();
            showStatus('타이머가 정지되었습니다.', 'info');
        }

        function resetTimer() {
            stopTimer();
            timeLeft = parseInt(document.getElementById('timeSelect').value);
            totalTime = timeLeft;
            updateTimerDisplay();
            showStatus('타이머가 리셋되었습니다.', 'info');
        }

        function setTimer() {
            const selectedTime = parseInt(document.getElementById('timeSelect').value);
            if (!isTimerRunning) {
                timeLeft = selectedTime;
                totalTime = selectedTime;
                updateTimerDisplay();
            }
        }

        function updateTimer() {
            timeLeft--;
            updateTimerDisplay();
            updateProgress();
            
            // 알림 설정 확인
            const alertTime = parseInt(document.getElementById('alertSettings').value);
            if (timeLeft === alertTime) {
                showStatus(`⚠️ ${Math.floor(alertTime/60)}분 남았습니다!`, 'warning');
            }
            
            // 시간 종료
            if (timeLeft <= 0) {
                clearInterval(timerInterval);
                isTimerRunning = false;
                timeLeft = 0;
                updateTimerDisplay();
                updateTimerButtons();
                showStatus('⏰ 시간이 종료되었습니다!', 'error');
                recordStageEnd();
                
                // 자동 다음 단계 제안
                setTimeout(() => {
                    if (confirm('시간이 종료되었습니다. 다음 단계로 이동하시겠습니까?')) {
                        nextStage();
                    }
                }, 1000);
            }
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            const display = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            const timerElement = document.getElementById('timerDisplay');
            timerElement.textContent = display;
            
            // 색상 변경
            timerElement.className = 'timer-display';
            if (timeLeft <= 60) {
                timerElement.classList.add('danger');
            } else if (timeLeft <= 180) {
                timerElement.classList.add('warning');
            }
            
            // 총 시간 업데이트
            updateTotalTime();
        }

        function updateProgress() {
            const progress = ((totalTime - timeLeft) / totalTime) * 100;
            document.getElementById('timerProgress').style.width = `${progress}%`;
        }

        function updateTimerButtons() {
            const startBtn = document.getElementById('startBtn');
            const pauseBtn = document.getElementById('pauseBtn');
            const stopBtn = document.getElementById('stopBtn');
            
            if (isTimerRunning) {
                startBtn.disabled = true;
                pauseBtn.disabled = false;
                stopBtn.disabled = false;
            } else {
                startBtn.disabled = timeLeft <= 0;
                pauseBtn.disabled = true;
                stopBtn.disabled = false;
            }
        }

        function updateTotalTime() {
            if (!debateData.startTime) return;
            
            const elapsed = Math.floor((Date.now() - debateData.startTime) / 1000);
            const minutes = Math.floor(elapsed / 60);
            const seconds = elapsed % 60;
            document.getElementById('totalTime').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // ===== 단계 관리 시스템 =====
        function selectStage(stage) {
            if (stage === currentStage) return;
            
            // 현재 단계 저장
            recordStageEnd();
            
            // 단계 변경
            document.getElementById(`stage${currentStage}`).classList.remove('active');
            currentStage = stage;
            document.getElementById(`stage${currentStage}`).classList.add('active');
            
            // 단계별 권장 시간 설정
            const stageTimes = { 1: 300, 2: 600, 3: 600, 4: 900, 5: 300 };
            document.getElementById('timeSelect').value = stageTimes[currentStage];
            if (!isTimerRunning) {
                setTimer();
            }
            
            // 통계 업데이트
            document.getElementById('currentStage').textContent = currentStage;
            
            recordStageStart();
            showStatus(`${currentStage}단계로 이동했습니다.`, 'info');
        }

        function nextStage() {
            if (currentStage < 5) {
                selectStage(currentStage + 1);
            } else {
                showStatus('마지막 단계입니다.', 'info');
            }
        }

        function prevStage() {
            if (currentStage > 1) {
                selectStage(currentStage - 1);
            } else {
                showStatus('첫 번째 단계입니다.', 'info');
            }
        }

        function completeStage() {
            const stageCard = document.getElementById(`stage${currentStage}`);
            stageCard.classList.add('completed');
            
            recordStageEnd();
            showStatus(`${currentStage}단계가 완료되었습니다!`, 'success');
            
            if (currentStage < 5) {
                setTimeout(() => {
                    if (confirm('다음 단계로 진행하시겠습니까?')) {
                        nextStage();
                    }
                }, 1000);
            } else {
                setTimeout(() => {
                    if (confirm('모든 단계가 완료되었습니다! 결과를 저장하시겠습니까?')) {
                        generateReport();
                    }
                }, 1000);
            }
        }

        function recordStageStart() {
            if (!debateData.startTime) {
                debateData.startTime = Date.now();
            }
            
            const stage = {
                stage: currentStage,
                startTime: Date.now(),
                endTime: null,
                duration: 0
            };
            
            debateData.stages.push(stage);
        }

        function recordStageEnd() {
            const lastStage = debateData.stages[debateData.stages.length - 1];
            if (lastStage && !lastStage.endTime) {
                lastStage.endTime = Date.now();
                lastStage.duration = Math.floor((lastStage.endTime - lastStage.startTime) / 1000);
            }
        }

        // ===== AI 분석 시스템 =====
        async function analyzeDebate() {
            showLoading('AI 분석 중...');
            
            try {
                const proOpinions = document.getElementById('proOpinions').value;
                const conOpinions = document.getElementById('conOpinions').value;
                const topic = document.getElementById('debateTopicInput').value;
                
                if (!proOpinions.trim() || !conOpinions.trim()) {
                    showStatus('양 팀의 의견을 먼저 입력해주세요.', 'warning');
                    hideLoading();
                    return;
                }
                
                // 실제 AI 분석 (데모용 시뮬레이션)
                const analysis = await simulateAIAnalysis(topic, proOpinions, conOpinions);
                displayAIAnalysis(analysis);
                
                showStatus('AI 분석이 완료되었습니다!', 'success');
            } catch (error) {
                console.error('AI 분석 오류:', error);
                showStatus('AI 분석 중 오류가 발생했습니다.', 'error');
            } finally {
                hideLoading();
            }
        }

        async function simulateAIAnalysis(topic, proOpinions, conOpinions) {
            // 실제 AI API 호출 시뮬레이션
            await new Promise(resolve => setTimeout(resolve, 3000));
            
            const proLength = proOpinions.length;
            const conLength = conOpinions.length;
            const balance = Math.abs(proLength - conLength) / Math.max(proLength, conLength);
            const balanceScore = Math.round((1 - balance) * 100);
            
            return {
                balanceScore: balanceScore,
                proStrength: Math.floor(Math.random() * 30) + 70,
                conStrength: Math.floor(Math.random() * 30) + 70,
                suggestions: [
                    '양 팀 모두 구체적인 사례와 데이터를 제시하여 논리적 설득력을 높이세요.',
                    '상대방의 주장에 대한 직접적인 반박을 더 체계적으로 제시해보세요.',
                    '핵심 쟁점에 집중하여 논의의 초점을 명확히 하세요.',
                    '감정적 표현보다는 객관적 근거 중심의 논증을 강화하세요.'
                ]
            };
        }

        function displayAIAnalysis(analysis) {
            const container = document.getElementById('aiInsights');
            container.innerHTML = `
                <div style="margin-bottom: 20px;">
                    <h4 style="color: var(--primary-color); margin-bottom: 10px;">📊 토론 균형도 분석</h4>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                        <div style="text-align: center;">
                            <div style="font-size: 1.5rem; font-weight: bold; color: var(--success-color);">${analysis.proStrength}%</div>
                            <div>찬성팀 논리성</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 1.5rem; font-weight: bold; color: var(--primary-color);">${analysis.balanceScore}%</div>
                            <div>전체 균형도</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 1.5rem; font-weight: bold; color: var(--danger-color);">${analysis.conStrength}%</div>
                            <div>반대팀 논리성</div>
                        </div>
                    </div>
                </div>
                
                <h4 style="color: var(--primary-color); margin-bottom: 10px;">💡 AI 개선 제안</h4>
                <ul style="margin: 0; padding-left: 20px;">
                    ${analysis.suggestions.map(suggestion => `<li style="margin-bottom: 8px;">${suggestion}</li>`).join('')}
                </ul>
            `;
            
            // 통계에 균형도 업데이트
            document.getElementById('balanceScore').textContent = `${analysis.balanceScore}%`;
            
            // 차트 업데이트
            updateChart(analysis);
        }

        async function generateDebateQuestions() {
            const topic = document.getElementById('debateTopicInput').value;
            if (!topic.trim()) {
                showStatus('토론 주제를 먼저 입력해주세요.', 'warning');
                return;
            }
            
            showLoading('AI가 토론 질문을 생성하고 있습니다...');
            
            try {
                // 데모용 질문 생성
                const questions = [
                    `${topic}에 대한 핵심 쟁점은 무엇인가요?`,
                    `이 주제가 사회에 미치는 영향을 어떻게 평가하시나요?`,
                    `반대 의견에 대해 어떻게 반박하시겠습니까?`,
                    `구체적인 사례나 데이터를 제시해주세요.`,
                    `장기적 관점에서 이 문제를 어떻게 바라보시나요?`
                ];
                
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                const questionList = questions.map((q, i) => `${i + 1}. ${q}`).join('\n');
                alert(`🤖 AI 생성 토론 질문\n\n${questionList}\n\n이 질문들을 토론 진행에 활용해보세요!`);
                
                showStatus('AI 토론 질문이 생성되었습니다!', 'success');
            } catch (error) {
                console.error('질문 생성 오류:', error);
                showStatus('질문 생성 중 오류가 발생했습니다.', 'error');
            } finally {
                hideLoading();
            }
        }

        // ===== 차트 시스템 =====
        function initializeChart() {
            const ctx = document.getElementById('debateChart').getContext('2d');
            chart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['찬성팀 발언', '반대팀 발언', '중립 시간'],
                    datasets: [{
                        data: [0, 0, 100],
                        backgroundColor: [
                            'rgba(16, 185, 129, 0.8)',
                            'rgba(239, 68, 68, 0.8)',
                            'rgba(156, 163, 175, 0.8)'
                        ],
                        borderColor: [
                            'rgba(16, 185, 129, 1)',
                            'rgba(239, 68, 68, 1)',
                            'rgba(156, 163, 175, 1)'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                        },
                        title: {
                            display: true,
                            text: '토론 시간 분배'
                        }
                    }
                }
            });
        }

        function updateChart(analysis) {
            if (chart && analysis) {
                chart.data.datasets[0].data = [
                    analysis.proStrength,
                    analysis.conStrength,
                    100 - analysis.proStrength - analysis.conStrength
                ];
                chart.update();
            }
        }

        // ===== 결과 저장 및 관리 =====
        function saveResults() {
            debateData.topic = document.getElementById('debateTopicInput').value;
            debateData.opinions.pro = document.getElementById('proOpinions').value;
            debateData.opinions.con = document.getElementById('conOpinions').value;
            debateData.participants = participants;
            debateData.currentStage = currentStage;
            debateData.saveDate = new Date().toISOString();
            
            localStorage.setItem('debateResults', JSON.stringify(debateData));
            showStatus('토론 결과가 저장되었습니다!', 'success');
        }

        function loadSavedData() {
            const saved = localStorage.getItem('debateResults');
            if (saved) {
                try {
                    debateData = JSON.parse(saved);
                    if (debateData.topic) {
                        document.getElementById('debateTopicInput').value = debateData.topic;
                    }
                    if (debateData.opinions) {
                        document.getElementById('proOpinions').value = debateData.opinions.pro || '';
                        document.getElementById('conOpinions').value = debateData.opinions.con || '';
                    }
                } catch (error) {
                    console.error('저장된 데이터 로드 오류:', error);
                }
            }
        }

        function saveDebateData() {
            debateData.participants = participants;
            debateData.currentStage = currentStage;
            debateData.lastUpdate = Date.now();
        }

        async function generateReport() {
            showLoading('리포트 생성 중...');
            
            try {
                const report = generateDebateReport();
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                displayReport(report);
                showStatus('토론 리포트가 생성되었습니다!', 'success');
            } catch (error) {
                console.error('리포트 생성 오류:', error);
                showStatus('리포트 생성 중 오류가 발생했습니다.', 'error');
            } finally {
                hideLoading();
            }
        }

        function generateDebateReport() {
            const topic = document.getElementById('debateTopicInput').value || '토론 주제 미설정';
            const proOpinions = document.getElementById('proOpinions').value;
            const conOpinions = document.getElementById('conOpinions').value;
            const totalDuration = debateData.stages.reduce((sum, stage) => sum + (stage.duration || 0), 0);
            
            return {
                topic: topic,
                date: new Date().toLocaleDateString('ko-KR'),
                totalTime: `${Math.floor(totalDuration / 60)}분 ${totalDuration % 60}초`,
                stages: debateData.stages.length,
                participants: {
                    pro: participants.pro.length,
                    con: participants.con.length
                },
                opinions: {
                    pro: proOpinions,
                    con: conOpinions
                }
            };
        }

        function displayReport(report) {
            const reportWindow = window.open('', '_blank');
            const reportHtml = `
                <!DOCTYPE html>
                <html lang="ko">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>토론 결과 리포트</title>
                    <style>
                        body { 
                            font-family: 'Malgun Gothic', -apple-system, sans-serif; 
                            line-height: 1.6; 
                            margin: 0; 
                            padding: 40px;
                            background: #f8fafc;
                        }
                        .container {
                            max-width: 800px;
                            margin: 0 auto;
                            background: white;
                            padding: 40px;
                            border-radius: 16px;
                            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
                        }
                        .header { 
                            text-align: center; 
                            margin-bottom: 40px; 
                            padding-bottom: 20px;
                            border-bottom: 3px solid #3b82f6;
                        }
                        .header h1 {
                            color: #3b82f6;
                            font-size: 2rem;
                            margin-bottom: 10px;
                        }
                        .info-grid {
                            display: grid;
                            grid-template-columns: 1fr 1fr;
                            gap: 20px;
                            margin-bottom: 30px;
                        }
                        .info-card {
                            background: #f8fafc;
                            padding: 20px;
                            border-radius: 12px;
                            border: 2px solid #e2e8f0;
                        }
                        .team-section { 
                            margin-bottom: 30px; 
                            padding: 25px; 
                            border-radius: 12px;
                        }
                        .pro-team { 
                            border: 2px solid #10b981; 
                            background: linear-gradient(135deg, #ecfdf5, #f0fdf4); 
                        }
                        .con-team { 
                            border: 2px solid #ef4444; 
                            background: linear-gradient(135deg, #fef2f2, #fef5f5); 
                        }
                        .team-title {
                            font-size: 1.3rem;
                            font-weight: bold;
                            margin-bottom: 15px;
                            display: flex;
                            align-items: center;
                            gap: 10px;
                        }
                        .pro-team .team-title { color: #10b981; }
                        .con-team .team-title { color: #ef4444; }
                        .opinion-text {
                            white-space: pre-wrap;
                            line-height: 1.8;
                            padding: 15px;
                            background: white;
                            border-radius: 8px;
                            border: 1px solid #e2e8f0;
                        }
                        .footer {
                            margin-top: 40px;
                            text-align: center;
                            color: #6b7280;
                            font-size: 0.9rem;
                        }
                        @media print {
                            body { background: white; }
                            .container { box-shadow: none; }
                        }
                    </style>
                </head>
                <body>
                    <div class="container">
                        <div class="header">
                            <h1>💬 토론 결과 리포트</h1>
                            <p><strong>주제:</strong> ${report.topic}</p>
                            <p>생성일: ${report.date}</p>
                        </div>
                        
                        <div class="info-grid">
                            <div class="info-card">
                                <h3>📊 토론 정보</h3>
                                <p><strong>총 소요시간:</strong> ${report.totalTime}</p>
                                <p><strong>진행 단계:</strong> ${report.stages}단계</p>
                            </div>
                            <div class="info-card">
                                <h3>👥 참가자 정보</h3>
                                <p><strong>찬성팀:</strong> ${report.participants.pro}명</p>
                                <p><strong>반대팀:</strong> ${report.participants.con}명</p>
                            </div>
                        </div>
                        
                        <div class="team-section pro-team">
                            <div class="team-title">
                                <span>👍</span>
                                찬성팀 주요 의견
                            </div>
                            <div class="opinion-text">${report.opinions.pro || '기록된 의견이 없습니다.'}</div>
                        </div>
                        
                        <div class="team-section con-team">
                            <div class="team-title">
                                <span>👎</span>
                                반대팀 주요 의견
                            </div>
                            <div class="opinion-text">${report.opinions.con || '기록된 의견이 없습니다.'}</div>
                        </div>
                        
                        <div class="footer">
                            <p>SuperClaude Framework - 실시간 토론 진행 도구</p>
                            <p>생성 시각: ${new Date().toLocaleString('ko-KR')}</p>
                        </div>
                    </div>
                </body>
                </html>
            `;
            
            reportWindow.document.write(reportHtml);
            reportWindow.document.close();
        }

        function printResults() {
            const report = generateDebateReport();
            displayReport(report);
            setTimeout(() => {
                window.print();
            }, 1000);
        }

        function exportResults() {
            const exportData = {
                ...debateData,
                exportDate: new Date().toISOString(),
                version: '2.0'
            };
            
            const blob = new Blob([JSON.stringify(exportData, null, 2)], { 
                type: 'application/json' 
            });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `토론결과_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            showStatus('토론 결과를 내보냈습니다.', 'success');
        }

        function shareResults() {
            if (navigator.share) {
                const report = generateDebateReport();
                navigator.share({
                    title: '토론 결과 공유',
                    text: `토론 주제: ${report.topic}\n진행 시간: ${report.totalTime}\n참가자: ${report.participants.pro + report.participants.con}명`,
                    url: window.location.href
                });
            } else {
                // 폴백: 클립보드 복사
                const report = generateDebateReport();
                const shareText = `
🎯 토론 주제: ${report.topic}
📅 일시: ${report.date}
⏱️ 소요시간: ${report.totalTime}
👥 참가자: ${report.participants.pro + report.participants.con}명 (찬성 ${report.participants.pro}명, 반대 ${report.participants.con}명)

SuperClaude Framework - 실시간 토론 진행 도구
                `.trim();
                
                navigator.clipboard.writeText(shareText).then(() => {
                    showStatus('공유 정보가 클립보드에 복사되었습니다!', 'success');
                });
            }
        }

        // ===== 세션 관리 =====
        function startDebateSession() {
            const topic = document.getElementById('debateTopicInput').value;
            if (!topic.trim()) {
                showStatus('토론 주제를 입력해주세요.', 'warning');
                return;
            }
            
            debateData.topic = topic;
            debateData.startTime = Date.now();
            debateData.stages = [];
            
            showStatus('토론 세션이 시작되었습니다!', 'success');
            recordStageStart();
        }

        // ===== 유틸리티 함수 =====
        function showLoading(message = '처리 중...') {
            const overlay = document.getElementById('loadingOverlay');
            const content = overlay.querySelector('.loading-content h3');
            content.textContent = message;
            overlay.classList.add('active');
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').classList.remove('active');
        }

        function showStatus(message, type = 'info') {
            const statusEl = document.getElementById('statusMessage');
            statusEl.textContent = message;
            statusEl.className = `status-message ${type}`;
            statusEl.classList.add('show');
            
            setTimeout(() => {
                statusEl.classList.remove('show');
            }, type === 'success' ? 3000 : 5000);
        }

        function showHelp() {
            const helpContent = `
🎯 실시간 토론 진행 도구 v2.0 사용 가이드

📋 주요 기능:
• AI 기반 토론 분석 및 질문 생성
• 실시간 타이머 및 단계별 진행 관리
• 참가자 발언 추적 및 의견 기록
• 토론 통계 및 균형도 분석
• 전문적인 결과 리포트 생성

⏰ 타이머 시스템:
• 단계별 권장 시간 자동 설정
• 시간 종료 알림 및 자동 단계 전환
• 진행률 시각화 및 상태 추적

👥 참가자 관리:
• 실시간 발언자 표시 및 전환
• 팀별 의견 실시간 기록
• 참가자 추가/제거 동적 관리

🤖 AI 분석:
• 토론 균형도 및 논리성 분석
• 개선 제안사항 자동 생성
• 토론 질문 AI 생성

📊 결과 관리:
• 상세한 토론 리포트 생성
• 다양한 형태로 내보내기 (JSON, 인쇄)
• 세션 데이터 자동 저장

💡 사용 팁:
• 각 단계마다 충분한 시간을 배정하세요
• 실시간으로 의견을 기록하여 나중에 분석하세요  
• AI 분석을 활용해 토론 품질을 개선하세요
• 정기적으로 결과를 저장하여 데이터를 보존하세요

🔧 문제 해결:
• 페이지 새로고침 시 데이터가 자동 복원됩니다
• 타이머가 작동하지 않으면 브라우저 새로고침을 시도하세요
• AI 분석이 실패하면 의견 입력을 다시 확인해주세요

더 자세한 매뉴얼이 필요하시면 도움말 버튼을 클릭하세요! 🚀
            `.trim();
            
            alert(helpContent);
        }

        // ===== 키보드 단축키 =====
        document.addEventListener('keydown', function(event) {
            if (event.ctrlKey || event.metaKey) {
                switch(event.key) {
                    case ' ': // Ctrl/Cmd + Space: 타이머 시작/일시정지
                        event.preventDefault();
                        if (isTimerRunning) {
                            pauseTimer();
                        } else {
                            startTimer();
                        }
                        break;
                    case 'r': // Ctrl/Cmd + R: 타이머 리셋
                        event.preventDefault();
                        resetTimer();
                        break;
                    case 's': // Ctrl/Cmd + S: 결과 저장
                        event.preventDefault();
                        saveResults();
                        break;
                    case 'Enter': // Ctrl/Cmd + Enter: 다음 단계
                        event.preventDefault();
                        nextStage();
                        break;
                }
            }
        });

        // ===== 페이지 언로드 시 데이터 저장 =====
        window.addEventListener('beforeunload', function(event) {
            saveResults();
        });

        // ===== 정기 자동 저장 =====
        setInterval(() => {
            if (debateData.startTime) {
                saveResults();
            }
        }, 30000); // 30초마다 자동 저장
    </script>
</body>
</html>