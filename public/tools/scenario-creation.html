<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¯ AI í† ë¡  ì‹œë‚˜ë¦¬ì˜¤ ìƒì„± ì§€ì› ë„êµ¬</title>
    <style>
        /* ===== ê¸°ë³¸ ì„¤ì • ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #3b82f6;
            --primary-hover: #2563eb;
            --secondary-color: #64748b;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --bg-color: #f8fafc;
            --card-bg: #ffffff;
            --text-color: #1f2937;
            --border-color: #e2e8f0;
            --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            /* ëª©ì ë³„ ìƒ‰ìƒ */
            --critical-color: #dc2626;
            --communication-color: #059669;
            --creative-color: #7c3aed;
            --democratic-color: #2563eb;
            --perspective-color: #ea580c;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f0f9ff 0%, #e0e7ff 100%);
            color: var(--text-color);
            line-height: 1.6;
            min-height: 100vh;
        }

        /* ===== í—¤ë” ===== */
        .header {
            text-align: center;
            padding: 40px 20px;
            background: linear-gradient(135deg, var(--primary-color), #3b82f6);
            color: white;
            box-shadow: var(--shadow-lg);
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        /* ===== ì»¨í…Œì´ë„ˆ ===== */
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }

        /* ===== ì¹´ë“œ ===== */
        .card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
        }

        .card h2 {
            color: var(--primary-color);
            margin-bottom: 20px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card.guide {
            background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
            border: 2px solid #0ea5e9;
        }

        /* ===== ì…ë ¥ í•„ë“œ ===== */
        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-color);
        }

        .input-group input, .input-group select, .input-group textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .input-group input:focus, .input-group select:focus, .input-group textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        /* ===== ì²´í¬ë°•ìŠ¤ ê·¸ë£¹ ===== */
        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .checkbox-item input[type="checkbox"] {
            width: auto;
        }

        /* ===== ë²„íŠ¼ ===== */
        .btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            background: var(--primary-hover);
            transform: translateY(-1px);
            box-shadow: var(--shadow-lg);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-success {
            background: var(--success-color);
        }

        .btn-warning {
            background: var(--warning-color);
        }

        .btn-danger {
            background: var(--danger-color);
        }

        .btn-secondary {
            background: var(--secondary-color);
        }

        .btn-full {
            width: 100%;
            justify-content: center;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        /* ===== ìˆ¨ê¹€ ì²˜ë¦¬ ===== */
        .hidden {
            display: none !important;
        }

        /* ===== ìƒíƒœ ë©”ì‹œì§€ ===== */
        .status-message {
            padding: 12px 20px;
            border-radius: 8px;
            margin: 20px 0;
            font-weight: 500;
        }

        .status-message.success {
            background: #dcfce7;
            color: #166534;
            border: 1px solid #bbf7d0;
        }

        .status-message.error {
            background: #fef2f2;
            color: #dc2626;
            border: 1px solid #fecaca;
        }

        .status-message.info {
            background: #eff6ff;
            color: #2563eb;
            border: 1px solid #dbeafe;
        }

        /* ===== ì£¼ì œ ì„ íƒ ===== */
        .topic-option {
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .topic-option:hover {
            border-color: var(--primary-color);
            box-shadow: var(--shadow);
            transform: translateY(-2px);
        }

        .topic-option.selected {
            border-color: var(--primary-color);
            background: linear-gradient(135deg, #eff6ff, #dbeafe);
            box-shadow: var(--shadow-lg);
        }

        .topic-option .select-indicator {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 20px;
            height: 20px;
            border: 2px solid var(--border-color);
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .topic-option.selected .select-indicator {
            background: var(--primary-color);
            border-color: var(--primary-color);
        }

        .topic-option.selected .select-indicator::after {
            content: 'âœ“';
            color: white;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 12px;
            font-weight: bold;
        }

        .topic-option h3 {
            color: var(--primary-color);
            margin-bottom: 10px;
            padding-right: 40px;
        }

        .topic-description {
            color: var(--secondary-color);
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        .pro-con-preview {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }

        .pro-preview, .con-preview {
            padding: 12px;
            border-radius: 8px;
            font-size: 0.9rem;
        }

        .pro-preview {
            background: #f0f9ff;
            border-left: 4px solid var(--success-color);
        }

        .con-preview {
            background: #fef2f2;
            border-left: 4px solid var(--danger-color);
        }

        .pro-label, .con-label {
            font-weight: 600;
            display: block;
            margin-bottom: 5px;
        }

        /* ===== ì‹œë‚˜ë¦¬ì˜¤ ê²°ê³¼ ===== */
        .scenario-section {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
        }

        .scenario-section h2 {
            color: var(--primary-color);
            font-size: 1.8rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .scenario-section h3 {
            color: var(--text-color);
            font-size: 1.3rem;
            margin: 20px 0 12px 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .scenario-section .icon {
            font-size: 1.2em;
        }

        .scenario-content {
            line-height: 1.7;
            color: var(--text-color);
        }

        .scenario-content p {
            margin-bottom: 15px;
        }

        .scenario-content ul {
            margin-left: 20px;
            margin-bottom: 15px;
        }

        .scenario-content li {
            margin-bottom: 8px;
        }

        /* ===== ë©”íƒ€ë°ì´í„° ê·¸ë¦¬ë“œ ===== */
        .metadata-section {
            background: linear-gradient(135deg, #f8fafc, #f1f5f9);
        }

        .metadata-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .metadata-item {
            padding: 15px;
            background: white;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .metadata-item strong {
            color: var(--primary-color);
            display: block;
            margin-bottom: 5px;
        }

        /* ===== ì°¬ë°˜ ë…¼ì  ===== */
        .pros-cons-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .pros-box, .cons-box {
            padding: 20px;
            border-radius: 12px;
            border: 2px solid;
        }

        .pros-box {
            background: linear-gradient(135deg, #f0fdf4, #dcfce7);
            border-color: var(--success-color);
        }

        .cons-box {
            background: linear-gradient(135deg, #fef2f2, #fee2e2);
            border-color: var(--danger-color);
        }

        .pros-box h4, .cons-box h4 {
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .pros-box h4 {
            color: var(--success-color);
        }

        .cons-box h4 {
            color: var(--danger-color);
        }

        /* ===== í•µì‹¬ ì§ˆë¬¸ë“¤ ===== */
        .key-questions-list {
            list-style: none;
        }

        .key-questions-list .question-item {
            background: linear-gradient(135deg, #fafafa, #f5f5f5);
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid var(--primary-color);
            font-weight: 500;
        }

        .key-questions-list .question-item:before {
            content: 'â“ ';
            color: var(--primary-color);
        }

        /* ===== ê¸°ëŒ€ í•™ìŠµ ì„±ê³¼ ===== */
        .outcomes-list {
            list-style: none;
        }

        .outcomes-list li {
            background: linear-gradient(135deg, #eff6ff, #dbeafe);
            padding: 12px;
            margin-bottom: 8px;
            border-radius: 8px;
            border-left: 4px solid var(--primary-color);
        }

        .outcomes-list li:before {
            content: 'ğŸ¯ ';
            color: var(--primary-color);
        }

        /* ===== ì¤€ë¹„ë¬¼ (í† ê¸€) ===== */
        .materials-toggle {
            cursor: pointer;
            user-select: none;
            transition: color 0.3s ease;
        }

        .materials-toggle:hover {
            color: var(--primary-hover);
        }

        .toggle-indicator {
            transition: transform 0.3s ease;
        }

        .toggle-indicator.rotated {
            transform: rotate(180deg);
        }

        .materials-content {
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .materials-list li {
            background: #f8fafc;
            padding: 10px;
            margin-bottom: 5px;
            border-radius: 6px;
            border-left: 3px solid var(--warning-color);
        }

        .materials-list li:before {
            content: 'ğŸ“¦ ';
            color: var(--warning-color);
        }

        /* ===== êµì‚¬ ì§€ë„ íŒ ===== */
        .teacher-tips-content {
            background: linear-gradient(135deg, #fef9e7, #fef3c7);
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid var(--warning-color);
        }

        /* ===== ëª©ì ë³„ ìƒ‰ìƒ ===== */
        .purpose-critical {
            border-left-color: var(--critical-color) !important;
        }

        .purpose-communication {
            border-left-color: var(--communication-color) !important;
        }

        .purpose-creative {
            border-left-color: var(--creative-color) !important;
        }

        .purpose-democratic {
            border-left-color: var(--democratic-color) !important;
        }

        .purpose-perspective {
            border-left-color: var(--perspective-color) !important;
        }

        .purpose-tag {
            font-size: 0.8rem;
            padding: 4px 8px;
            border-radius: 12px;
            background: var(--primary-color);
            color: white;
            margin-left: 10px;
        }

        /* ===== ì¬ì¶”ì²œ ì„¹ì…˜ ===== */
        .re-recommendation {
            background: linear-gradient(135deg, #fefce8, #fef3c7);
            border: 2px solid var(--warning-color);
            margin-top: 20px;
        }

        .feedback-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }

        .feedback-option {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            background: white;
            border-radius: 6px;
            font-size: 0.9rem;
        }

        /* ===== AI ì§„í–‰ë¥  íŒì—… ===== */
        .ai-progress-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            animation: fadeIn 0.3s ease;
        }

        .ai-progress-modal {
            background: white;
            border-radius: 20px;
            padding: 40px 30px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: aiProgressSlideIn 0.5s ease;
        }

        .ai-progress-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            animation: bounce 2s infinite;
        }

        .ai-progress-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .ai-progress-subtitle {
            color: var(--secondary-color);
            margin-bottom: 30px;
            font-size: 0.95rem;
        }

        .ai-progress-bar-container {
            background: #f1f5f9;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 30px;
        }

        .ai-progress-bar {
            background: linear-gradient(90deg, var(--primary-color), var(--success-color));
            height: 100%;
            width: 0%;
            transition: width 0.5s ease;
        }

        .ai-progress-steps {
            text-align: left;
        }

        .ai-progress-step {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 0;
            color: var(--secondary-color);
            font-size: 0.95rem;
            transition: all 0.3s ease;
        }

        .ai-progress-step.active {
            color: var(--primary-color);
            font-weight: 600;
            transform: translateX(5px);
        }

        .ai-progress-step.completed {
            color: var(--success-color);
        }

        .ai-progress-step-icon {
            font-size: 1.2em;
            width: 20px;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes aiProgressSlideIn {
            from { 
                opacity: 0;
                transform: translateY(-20px) scale(0.9);
            }
            to { 
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }

        /* ===== ë°˜ì‘í˜• ë””ìì¸ ===== */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }

            .container {
                padding: 15px;
            }

            .card {
                padding: 20px;
                margin-bottom: 20px;
            }

            .pros-cons-container {
                grid-template-columns: 1fr;
            }

            .pro-con-preview {
                grid-template-columns: 1fr;
            }

            .action-buttons {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }

            .ai-progress-modal {
                margin: 20px;
                padding: 30px 20px;
            }
        }
    </style>
</head>
<body>
    <!-- í—¤ë” -->
    <div class="header">
        <h1>ğŸ¯ AI í† ë¡  ì‹œë‚˜ë¦¬ì˜¤ ìƒì„± ì§€ì› ë„êµ¬</h1>
        <p>ì´ˆë“± í† ë¡  êµìœ¡ì„ ìœ„í•œ ë§ì¶¤í˜• ì‹œë‚˜ë¦¬ì˜¤ë¥¼ AIê°€ ìƒì„±í•´ë“œë¦½ë‹ˆë‹¤</p>
    </div>

    <div class="container">
        <!-- ì‚¬ìš© ê°€ì´ë“œ -->
        <div class="card guide">
            <h2>ğŸ“‹ ì‚¬ìš© ë°©ë²•</h2>
            <p><strong>1ë‹¨ê³„:</strong> í† ë¡  ì£¼ì œì™€ ê´€ë ¨ëœ í‚¤ì›Œë“œë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: í™˜ê²½ë³´í˜¸, ì¸ê³µì§€ëŠ¥, ìŠ¤ë§ˆíŠ¸í° ë“±)</p>
            <p><strong>2ë‹¨ê³„:</strong> AIê°€ ì¶”ì²œí•œ 3ê°œì˜ ì£¼ì œ ì¤‘ ì›í•˜ëŠ” ê²ƒì„ ì„ íƒí•˜ì„¸ìš”</p>
            <p><strong>3ë‹¨ê³„:</strong> í•™ë…„, êµê³¼, í† ë¡  ëª©ì ì„ ì„¤ì •í•˜ê³  ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ìƒì„±í•˜ì„¸ìš”</p>
            <p><strong>ğŸ’¡ íŒ:</strong> êµ¬ì²´ì ì¸ í‚¤ì›Œë“œì¼ìˆ˜ë¡ ë” ì •í™•í•œ ì£¼ì œ ì¶”ì²œì„ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤!</p>
        </div>

        <!-- ìƒíƒœ ë©”ì‹œì§€ -->
        <div id="status-message" class="status-message hidden"></div>

        <!-- 1ë‹¨ê³„: í‚¤ì›Œë“œ ì…ë ¥ ë° ì£¼ì œ ì¶”ì²œ -->
        <div class="card" id="topic-input">
            <h2>ğŸ” 1ë‹¨ê³„: í† ë¡  ì£¼ì œ í‚¤ì›Œë“œ ì…ë ¥</h2>
            
            <div class="input-group">
                <label for="keyword">í† ë¡  ì£¼ì œ í‚¤ì›Œë“œ</label>
                <input type="text" id="keyword" placeholder="ì˜ˆ: í™˜ê²½ë³´í˜¸, ì¸ê³µì§€ëŠ¥, ìŠ¤ë§ˆíŠ¸í°, ë…ì„œ ë“±">
            </div>

            <div class="input-group">
                <label for="topic-purpose">í† ë¡  ëª©ì  (ì„ íƒì‚¬í•­)</label>
                <select id="topic-purpose">
                    <option value="">ëª©ì ì„ ì„ íƒí•´ì£¼ì„¸ìš”</option>
                    <option value="ë¹„íŒì  ì‚¬ê³ ë ¥ ê¸°ë¥´ê¸°">ë¹„íŒì  ì‚¬ê³ ë ¥ ê¸°ë¥´ê¸°</option>
                    <option value="ì˜ì‚¬ì†Œí†µ ëŠ¥ë ¥ í–¥ìƒ">ì˜ì‚¬ì†Œí†µ ëŠ¥ë ¥ í–¥ìƒ</option>
                    <option value="ë‹¤ì–‘í•œ ê´€ì  ì´í•´í•˜ê¸°">ë‹¤ì–‘í•œ ê´€ì  ì´í•´í•˜ê¸°</option>
                    <option value="ë¯¼ì£¼ì  ì˜ì‚¬ê²°ì • ëŠ¥ë ¥">ë¯¼ì£¼ì  ì˜ì‚¬ê²°ì • ëŠ¥ë ¥</option>
                    <option value="ì°½ì˜ì  ë¬¸ì œí•´ê²°">ì°½ì˜ì  ë¬¸ì œí•´ê²°</option>
                </select>
            </div>

            <button class="btn btn-full" id="recommend-btn" onclick="getTopicRecommendations()">
                ğŸ¤– AI ì£¼ì œ ì¶”ì²œ ë°›ê¸°
            </button>
        </div>

        <!-- 2ë‹¨ê³„: ì£¼ì œ ì„ íƒ -->
        <div class="card hidden" id="topic-selection">
            <h2>ğŸ¯ 2ë‹¨ê³„: í† ë¡  ì£¼ì œ ì„ íƒ</h2>
            <p>AIê°€ ì¶”ì²œí•œ ì£¼ì œ ì¤‘ í•˜ë‚˜ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”:</p>
            <div id="topic-list"></div>
            
            <!-- ì¬ì¶”ì²œ ì„¹ì…˜ -->
            <div class="card re-recommendation hidden" id="re-recommendation-section">
                <h2>ğŸ”„ ë‹¤ë¥¸ ì£¼ì œê°€ í•„ìš”í•˜ì‹ ê°€ìš”?</h2>
                <p>ì•„ë˜ í”¼ë“œë°±ì„ ì„ íƒí•˜ì‹œë©´ ë” ì í•©í•œ ì£¼ì œë¥¼ ì¶”ì²œí•´ë“œë¦½ë‹ˆë‹¤:</p>
                
                <div class="feedback-options">
                    <div class="feedback-option">
                        <input type="checkbox" name="feedback" value="ë” ì‰¬ìš´ ì£¼ì œ" id="feedback-easy">
                        <label for="feedback-easy">ë” ì‰¬ìš´ ì£¼ì œ</label>
                    </div>
                    <div class="feedback-option">
                        <input type="checkbox" name="feedback" value="ë” ì–´ë ¤ìš´ ì£¼ì œ" id="feedback-hard">
                        <label for="feedback-hard">ë” ì–´ë ¤ìš´ ì£¼ì œ</label>
                    </div>
                    <div class="feedback-option">
                        <input type="checkbox" name="feedback" value="ë” êµ¬ì²´ì ì¸ ì£¼ì œ" id="feedback-specific">
                        <label for="feedback-specific">ë” êµ¬ì²´ì ì¸ ì£¼ì œ</label>
                    </div>
                    <div class="feedback-option">
                        <input type="checkbox" name="feedback" value="ë” ì¼ë°˜ì ì¸ ì£¼ì œ" id="feedback-general">
                        <label for="feedback-general">ë” ì¼ë°˜ì ì¸ ì£¼ì œ</label>
                    </div>
                    <div class="feedback-option">
                        <input type="checkbox" name="feedback" value="í•™êµìƒí™œ ê´€ë ¨" id="feedback-school">
                        <label for="feedback-school">í•™êµìƒí™œ ê´€ë ¨</label>
                    </div>
                    <div class="feedback-option">
                        <input type="checkbox" name="feedback" value="ì‚¬íšŒë¬¸ì œ ê´€ë ¨" id="feedback-social">
                        <label for="feedback-social">ì‚¬íšŒë¬¸ì œ ê´€ë ¨</label>
                    </div>
                </div>
                
                <div class="input-group">
                    <label for="manual-feedback">ì¶”ê°€ ìš”ì²­ì‚¬í•­ (ì„ íƒì‚¬í•­)</label>
                    <textarea id="manual-feedback" rows="2" placeholder="ì˜ˆ: ë” í¥ë¯¸ë¡œìš´ ì£¼ì œ, ì²´í—˜í•  ìˆ˜ ìˆëŠ” ì£¼ì œ ë“±"></textarea>
                </div>
                
                <button class="btn btn-warning btn-full" id="re-recommend-btn" onclick="reRecommendTopics()">
                    ğŸ”„ ìƒˆë¡œìš´ ì£¼ì œ ì¶”ì²œë°›ê¸°
                </button>
            </div>
        </div>

        <!-- 3ë‹¨ê³„: ì‹œë‚˜ë¦¬ì˜¤ ìƒì„± ì„¤ì • -->
        <div class="card hidden" id="scenario-generation">
            <h2>âš™ï¸ 3ë‹¨ê³„: ì‹œë‚˜ë¦¬ì˜¤ ìƒì„± ì„¤ì •</h2>
            
            <div class="input-group">
                <label for="grade">ëŒ€ìƒ í•™ë…„</label>
                <select id="grade">
                    <option value="">í•™ë…„ì„ ì„ íƒí•´ì£¼ì„¸ìš”</option>
                    <option value="1-2í•™ë…„">1-2í•™ë…„</option>
                    <option value="3-4í•™ë…„">3-4í•™ë…„</option>
                    <option value="5-6í•™ë…„">5-6í•™ë…„</option>
                    <option value="ì „í•™ë…„">ì „í•™ë…„</option>
                </select>
            </div>

            <div class="input-group">
                <label>ê´€ë ¨ êµê³¼ (ë³µìˆ˜ì„ íƒ ê°€ëŠ¥)</label>
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="checkbox" name="subject" value="êµ­ì–´" id="korean">
                        <label for="korean">êµ­ì–´</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" name="subject" value="ë„ë•" id="ethics">
                        <label for="ethics">ë„ë•</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" name="subject" value="ì‚¬íšŒ" id="social">
                        <label for="social">ì‚¬íšŒ</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" name="subject" value="ê³¼í•™" id="science">
                        <label for="science">ê³¼í•™</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" name="subject" value="ì‹¤ê³¼" id="practical">
                        <label for="practical">ì‹¤ê³¼</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" name="subject" value="ì°½ì²´" id="creative">
                        <label for="creative">ì°½ì²´</label>
                    </div>
                </div>
            </div>

            <div class="input-group">
                <label for="time">ì˜ˆìƒ ìˆ˜ì—…ì‹œê°„</label>
                <select id="time">
                    <option value="">ì‹œê°„ì„ ì„ íƒí•´ì£¼ì„¸ìš”</option>
                    <option value="40ë¶„(1ì°¨ì‹œ)">40ë¶„(1ì°¨ì‹œ)</option>
                    <option value="80ë¶„(2ì°¨ì‹œ)">80ë¶„(2ì°¨ì‹œ)</option>
                    <option value="120ë¶„(3ì°¨ì‹œ)">120ë¶„(3ì°¨ì‹œ)</option>
                </select>
            </div>

            <button class="btn btn-success btn-full" id="generate-btn" onclick="generateScenario()">
                âœ¨ í† ë¡  ì‹œë‚˜ë¦¬ì˜¤ ìƒì„±í•˜ê¸°
            </button>
        </div>

        <!-- 4ë‹¨ê³„: ê²°ê³¼ í‘œì‹œ -->
        <div class="card hidden" id="result-section">
            <h2>ğŸ“‹ ìƒì„±ëœ í† ë¡  ì‹œë‚˜ë¦¬ì˜¤</h2>
            <div id="scenario-result"></div>
            
            <div class="action-buttons">
                <button class="btn btn-success" onclick="saveScenario()">
                    ğŸ’¾ ì‹œë‚˜ë¦¬ì˜¤ ì €ì¥
                </button>
                <button class="btn btn-secondary" onclick="printScenario()">
                    ğŸ–¨ï¸ ì¸ì‡„í•˜ê¸°
                </button>
                <button class="btn btn-warning" onclick="copyScenario()">
                    ğŸ“‹ ë³µì‚¬í•˜ê¸°
                </button>
                <button class="btn btn-primary" onclick="location.reload()">
                    ğŸ”„ ìƒˆ ì‹œë‚˜ë¦¬ì˜¤ ë§Œë“¤ê¸°
                </button>
            </div>
        </div>
    </div>

    <script>
        // ===== AI í† ë¡  ì‹œë‚˜ë¦¬ì˜¤ ìƒì„±ê¸° ë©”ì¸ ë¡œì§ =====

        // ì „ì—­ ë³€ìˆ˜
        let selectedTopic = null;
        let currentTopics = [];

        // í˜ì´ì§€ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ AI í† ë¡  ì‹œë‚˜ë¦¬ì˜¤ ìƒì„±ê¸° ì´ˆê¸°í™” ì™„ë£Œ');
            
            // í‚¤ì›Œë“œ ì…ë ¥ í•„ë“œì— í¬ì»¤ìŠ¤
            document.getElementById('keyword').focus();
            
            // Enter í‚¤ë¡œ ë‹¤ìŒ ë‹¨ê³„ ì§„í–‰
            document.getElementById('keyword').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    getTopicRecommendations();
                }
            });
            
            showStatus('ğŸ¯ í‚¤ì›Œë“œë¥¼ ì…ë ¥í•˜ì—¬ AI í† ë¡  ì£¼ì œ ì¶”ì²œì„ ë°›ì•„ë³´ì„¸ìš”!', 'info');
        });

        // ===== ìƒíƒœ ë©”ì‹œì§€ í‘œì‹œ =====
        function showStatus(message, type = 'info') {
            const statusEl = document.getElementById('status-message');
            if (!statusEl) {
                console.warn('status-message element not found');
                return;
            }
            statusEl.textContent = message;
            statusEl.className = `status-message ${type}`;
            statusEl.classList.remove('hidden');
            
            if (type === 'success' || type === 'error') {
                setTimeout(() => {
                    statusEl.classList.add('hidden');
                }, 5000);
            }
        }

        // ===== ì„¹ì…˜ í‘œì‹œ =====
        function showSection(sectionId) {
            const section = document.getElementById(sectionId);
            if (section) {
                section.classList.remove('hidden');
                section.style.display = 'block';
            }
        }

        // ===== OpenAI API í˜¸ì¶œ (ë°ëª¨ìš© - ì‹¤ì œë¡œëŠ” ì•ˆì „í•œ ë°±ì—”ë“œ ì„œë²„ì—ì„œ ì²˜ë¦¬í•´ì•¼ í•¨) =====
        async function callOpenAI(prompt) {
            // ì‹¤ì œ ìš´ì˜í™˜ê²½ì—ì„œëŠ” ë³´ì•ˆì„ ìœ„í•´ ë°±ì—”ë“œ APIë¥¼ í†µí•´ í˜¸ì¶œí•´ì•¼ í•©ë‹ˆë‹¤
            showStatus('âš ï¸ ë°ëª¨ ëª¨ë“œ: ì‹¤ì œ AI ì—°ë™ì´ í•„ìš”í•©ë‹ˆë‹¤', 'warning');
            
            // ì„ì‹œ ì‘ë‹µ ìƒì„± (ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” ì‹¤ì œ AI API í˜¸ì¶œ)
            return new Promise((resolve) => {
                setTimeout(() => {
                    if (prompt.includes('ì£¼ì œ ì¶”ì²œ')) {
                        resolve(`[
                            {
                                "title": "ì´ˆë“±í•™ìƒì˜ ìŠ¤ë§ˆíŠ¸í° ì‚¬ìš©ì„ ê¸ˆì§€í•´ì•¼ í•œë‹¤",
                                "description": "ì–´ë¦°ì´ ìŠ¤ë§ˆíŠ¸í° ì‚¬ìš©ì˜ ì¥ë‹¨ì ê³¼ ì ì ˆí•œ ê·œì œì— ëŒ€í•œ í† ë¡ ìœ¼ë¡œ, ë””ì§€í„¸ ì‹œëŒ€ì˜ êµìœ¡ ë°©í–¥ì„ ëª¨ìƒ‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
                                "proView": "ì§‘ì¤‘ë ¥ê³¼ ì‚¬íšŒì„± ë°œë‹¬ì„ ìœ„í•´ ì œí•œì´ í•„ìš”í•©ë‹ˆë‹¤",
                                "conView": "ì •ë³´ ì ‘ê·¼ê³¼ ì†Œí†µì„ ìœ„í•´ ì ì ˆí•œ ì‚¬ìš©ì´ í•„ìš”í•©ë‹ˆë‹¤"
                            },
                            {
                                "title": "ìˆ˜ì—… ì‹œê°„ì— ìŠ¤ë§ˆíŠ¸í°ì„ êµìœ¡ ë„êµ¬ë¡œ í™œìš©í•´ì•¼ í•œë‹¤",
                                "description": "ë””ì§€í„¸ ê¸°ê¸°ì˜ êµìœ¡ì  í™œìš© ê°€ëŠ¥ì„±ì— ëŒ€í•œ í† ë¡ ìœ¼ë¡œ, ì „í†µì  êµìœ¡ê³¼ ë””ì§€í„¸ êµìœ¡ì˜ ê· í˜•ì„ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
                                "proView": "í¥ë¯¸ë¡­ê³  íš¨ê³¼ì ì¸ í•™ìŠµì´ ê°€ëŠ¥í•©ë‹ˆë‹¤",
                                "conView": "ìˆ˜ì—… ì§‘ì¤‘ë„ê°€ ë–¨ì–´ì§€ê³  ì˜ì¡´ì„±ì´ ìƒê¹ë‹ˆë‹¤"
                            },
                            {
                                "title": "ìŠ¤ë§ˆíŠ¸í° ì‚¬ìš© ì‹œê°„ì„ í•˜ë£¨ 1ì‹œê°„ìœ¼ë¡œ ì œí•œí•´ì•¼ í•œë‹¤",
                                "description": "ê±´ì „í•œ ë””ì§€í„¸ ìŠµê´€ í˜•ì„±ì„ ìœ„í•œ ì‹œê°„ ì œí•œì˜ í•„ìš”ì„±ì— ëŒ€í•œ í† ë¡ ìœ¼ë¡œ, ìê¸°ì¡°ì ˆ ëŠ¥ë ¥ì„ ê¸°ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
                                "proView": "ê±´ê°•í•œ ìƒí™œìŠµê´€ê³¼ ì‹¤ì œ ì²´í—˜ì„ ìœ„í•´ í•„ìš”í•©ë‹ˆë‹¤",
                                "conView": "ê°œì¸ì˜ ìƒí™©ì— ë”°ë¼ ìœ ì—°í•˜ê²Œ ì¡°ì ˆë˜ì–´ì•¼ í•©ë‹ˆë‹¤"
                            }
                        ]`);
                    } else {
                        resolve(`{
                            "title": "${selectedTopic}",
                            "topic": "${selectedTopic}",
                            "keywords": ["í† ë¡ ", "êµìœ¡", "ì´ˆë“±í•™ìƒ"],
                            "grade": "5-6í•™ë…„",
                            "subject": ["ë„ë•", "ì‚¬íšŒ"],
                            "background": "ì´ ì£¼ì œëŠ” í˜„ëŒ€ ì‚¬íšŒì—ì„œ ì¤‘ìš”í•œ ì´ìŠˆë¡œ, í•™ìƒë“¤ì´ ë‹¤ì–‘í•œ ê´€ì ì—ì„œ ìƒê°í•´ë³¼ ìˆ˜ ìˆëŠ” ì£¼ì œì…ë‹ˆë‹¤.",
                            "proArguments": ["ì°¬ì„± ë…¼ì  1", "ì°¬ì„± ë…¼ì  2", "ì°¬ì„± ë…¼ì  3"],
                            "conArguments": ["ë°˜ëŒ€ ë…¼ì  1", "ë°˜ëŒ€ ë…¼ì  2", "ë°˜ëŒ€ ë…¼ì  3"],
                            "teacherTips": "í•™ìƒë“¤ì´ ì„œë¡œì˜ ì˜ê²¬ì„ ì¡´ì¤‘í•˜ë©° í† ë¡ í•  ìˆ˜ ìˆë„ë¡ ë¶„ìœ„ê¸°ë¥¼ ì¡°ì„±í•´ì£¼ì„¸ìš”.",
                            "keyQuestions": ["ì§ˆë¬¸ 1", "ì§ˆë¬¸ 2", "ì§ˆë¬¸ 3", "ì§ˆë¬¸ 4", "ì§ˆë¬¸ 5", "ì§ˆë¬¸ 6", "ì§ˆë¬¸ 7", "ì§ˆë¬¸ 8"],
                            "expectedOutcomes": ["í•™ìŠµì„±ê³¼ 1", "í•™ìŠµì„±ê³¼ 2", "í•™ìŠµì„±ê³¼ 3", "í•™ìŠµì„±ê³¼ 4"],
                            "materials": ["ì¤€ë¹„ë¬¼ 1", "ì¤€ë¹„ë¬¼ 2", "ì¤€ë¹„ë¬¼ 3"]
                        }`);
                    }
                }, 3000);
            });
        }

        // ===== 1ë‹¨ê³„: í† ë¡  ì£¼ì œ ì¶”ì²œ =====
        async function getTopicRecommendations() {
            const keyword = document.getElementById('keyword').value.trim();
            const selectedPurpose = document.getElementById('topic-purpose').value.trim();
            
            if (!keyword) {
                showStatus('í‚¤ì›Œë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }

            const recommendBtn = document.getElementById('recommend-btn');
            recommendBtn.disabled = true;
            showAIProgress('topic');

            try {
                const prompt = `í‚¤ì›Œë“œ: "${keyword}", ëª©ì : "${selectedPurpose}" - ì´ˆë“±í•™ìƒì„ ìœ„í•œ í† ë¡  ì£¼ì œ 3ê°œ ì¶”ì²œ`;
                const response = await callOpenAI(prompt + ' ì£¼ì œ ì¶”ì²œ');
                
                const topics = parseTopicResponse(response, keyword);
                displayTopics(topics);
                hideAIProgress();
                recommendBtn.disabled = false;
                showStatus('AIê°€ í† ë¡  ì£¼ì œ 3ê°œë¥¼ ì¶”ì²œí–ˆìŠµë‹ˆë‹¤!', 'success');
                
            } catch (error) {
                console.error('ì£¼ì œ ì¶”ì²œ ì˜¤ë¥˜:', error);
                hideAIProgress();
                recommendBtn.disabled = false;
                showStatus('ì£¼ì œ ì¶”ì²œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.', 'error');
            }
        }

        // ===== JSON ì‘ë‹µ íŒŒì‹± =====
        function parseTopicResponse(response, keyword) {
            try {
                let jsonStr = response.trim();
                
                if (jsonStr.includes('```')) {
                    const match = jsonStr.match(/```(?:json)?\s*(\[[\s\S]*?\])\s*```/);
                    if (match) {
                        jsonStr = match[1];
                    }
                }
                
                const topics = JSON.parse(jsonStr);
                
                if (Array.isArray(topics) && topics.length === 3) {
                    return topics;
                } else {
                    throw new Error('ì˜ëª»ëœ JSON í˜•ì‹');
                }
            } catch (error) {
                console.error('JSON íŒŒì‹± ì‹¤íŒ¨:', error);
                // ê¸°ë³¸ ì£¼ì œ ë°˜í™˜
                return [
                    { 
                        title: `${keyword}ì— ëŒ€í•œ ìš°ë¦¬ í•™êµì˜ ìƒˆë¡œìš´ ê·œì¹™ì„ ë§Œë“¤ì–´ì•¼ í•œë‹¤`, 
                        description: `${keyword}ì™€ ê´€ë ¨ëœ í•™êµ ê·œì¹™ ì œì •ì˜ í•„ìš”ì„±ì— ëŒ€í•œ í† ë¡ ì…ë‹ˆë‹¤.`,
                        proView: 'ëª…í™•í•œ ê·œì¹™ì´ ìˆì–´ì•¼ ëª¨ë‘ê°€ í¸ì•ˆí•©ë‹ˆë‹¤',
                        conView: 'ë„ˆë¬´ ë§ì€ ê·œì¹™ì€ ììœ ë¥¼ ì œí•œí•©ë‹ˆë‹¤'
                    },
                    { 
                        title: `${keyword} êµìœ¡ì„ ì˜ë¬´í™”í•´ì•¼ í•œë‹¤`, 
                        description: `${keyword} ê´€ë ¨ êµìœ¡ì˜ í•„ìš”ì„±ê³¼ ì˜ë¬´í™”ì— ëŒ€í•œ í† ë¡ ì…ë‹ˆë‹¤.`,
                        proView: 'ëª¨ë“  í•™ìƒì´ ê· ë“±í•˜ê²Œ ë°°ìš¸ ê¸°íšŒë¥¼ ê°€ì ¸ì•¼ í•©ë‹ˆë‹¤',
                        conView: 'ê°œì¸ì˜ ê´€ì‹¬ê³¼ ì„ íƒì„ ì¡´ì¤‘í•´ì•¼ í•©ë‹ˆë‹¤'
                    },
                    { 
                        title: `${keyword}ë³´ë‹¤ ë‹¤ë¥¸ ê²ƒì´ ë” ì¤‘ìš”í•˜ë‹¤`, 
                        description: `${keyword}ì˜ ìš°ì„ ìˆœìœ„ì™€ ì¤‘ìš”ë„ì— ëŒ€í•œ í† ë¡ ì…ë‹ˆë‹¤.`,
                        proView: 'ë‹¤ì–‘í•œ ê°€ì¹˜ë¥¼ ê· í˜•ìˆê²Œ ê³ ë ¤í•´ì•¼ í•©ë‹ˆë‹¤',
                        conView: `${keyword}ê°€ í˜„ì¬ ê°€ì¥ ì‹œê¸‰í•œ ë¬¸ì œì…ë‹ˆë‹¤`
                    }
                ];
            }
        }

        // ===== ì£¼ì œ ì¶”ì²œ í‘œì‹œ =====
        function displayTopics(topics) {
            const topicList = document.getElementById('topic-list');
            currentTopics = topics;
            
            let html = '';
            topics.forEach((topic, index) => {
                const hasProCon = topic.proView && topic.conView;
                
                html += `
                    <div class="topic-option" onclick="selectTopicOption(${index}, '${topic.title.replace(/'/g, "\\'")}')">
                        <div class="select-indicator"></div>
                        <h3>${topic.title}</h3>
                        <p class="topic-description">${topic.description || ''}</p>
                        ${hasProCon ? `
                            <div class="pro-con-preview">
                                <div class="pro-preview">
                                    <span class="pro-label">ğŸ‘ ì°¬ì„±</span>
                                    <span class="pro-text">${topic.proView}</span>
                                </div>
                                <div class="con-preview">
                                    <span class="con-label">ğŸ‘ ë°˜ëŒ€</span>
                                    <span class="con-text">${topic.conView}</span>
                                </div>
                            </div>
                        ` : ''}
                    </div>
                `;
            });
            
            topicList.innerHTML = html;
            showSection('topic-selection');
            
            // ì¬ì¶”ì²œ ì„¹ì…˜ í‘œì‹œ
            const reRecommendSection = document.getElementById('re-recommendation-section');
            if (reRecommendSection) {
                reRecommendSection.classList.remove('hidden');
                reRecommendSection.style.display = 'block';
                reRecommendSection.style.visibility = 'visible';
            }
            
            document.getElementById('topic-selection').scrollIntoView({ behavior: 'smooth' });
        }

        // ===== ì£¼ì œ ì„ íƒ =====
        function selectTopicOption(index, topicTitle) {
            // ì´ì „ ì„ íƒ ì œê±°
            document.querySelectorAll('.topic-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            // í˜„ì¬ ì„ íƒ í‘œì‹œ
            const selectedOption = document.querySelectorAll('.topic-option')[index];
            selectedOption.classList.add('selected');
            
            // ì „ì—­ ë³€ìˆ˜ì— ì„ íƒëœ ì£¼ì œ ì €ì¥
            selectedTopic = currentTopics[index].title;
            
            // ì£¼ì œ ì¶”ì²œ ë‹¨ê³„ì—ì„œ ì„ íƒí•œ ëª©ì ì„ ì‹œë‚˜ë¦¬ì˜¤ ìƒì„± ë‹¨ê³„ì— ìë™ ë°˜ì˜
            const selectedTopicPurpose = document.getElementById('topic-purpose').value;
            if (selectedTopicPurpose) {
                const scenarioPurposeField = document.getElementById('purpose');
                if (scenarioPurposeField) {
                    scenarioPurposeField.value = selectedTopicPurpose;
                }
            }
            
            // ì‹œë‚˜ë¦¬ì˜¤ ìƒì„± ì„¹ì…˜ í‘œì‹œ
            showSection('scenario-generation');
            document.getElementById('scenario-generation').scrollIntoView({ behavior: 'smooth' });
            
            let statusMessage = `"${topicTitle}" ì£¼ì œê°€ ì„ íƒë˜ì—ˆìŠµë‹ˆë‹¤!`;
            if (selectedTopicPurpose) {
                statusMessage += ` (${selectedTopicPurpose} ëª©ì  ë°˜ì˜ë¨)`;
            }
            showStatus(statusMessage, 'success');
        }

        // ===== ì‹œë‚˜ë¦¬ì˜¤ ìƒì„± =====
        async function generateScenario() {
            if (!selectedTopic) {
                showStatus('ë¨¼ì € í† ë¡  ì£¼ì œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.', 'error');
                return;
            }

            const grade = document.getElementById('grade').value;
            
            // ë‹¤ì¤‘ ì„ íƒëœ êµê³¼ë“¤ ìˆ˜ì§‘
            const selectedSubjects = Array.from(document.querySelectorAll('input[name="subject"]:checked'))
                .map(checkbox => checkbox.value);
            const subjectText = selectedSubjects.length > 0 ? selectedSubjects.join(', ') : '';
            
            const time = document.getElementById('time').value;
            // í† ë¡  ì£¼ì œ ì¶”ì²œ ë‹¨ê³„ì—ì„œ ì„ íƒí•œ ëª©ì  ì‚¬ìš©
            const topicPurposeField = document.getElementById('topic-purpose');
            const purpose = topicPurposeField ? topicPurposeField.value.trim() : '';

            const generateBtn = document.getElementById('generate-btn');
            generateBtn.disabled = true;
            showAIProgress('scenario');

            try {
                const prompt = `ë‹¤ìŒ ì£¼ì œì— ëŒ€í•œ í† ë¡  ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ë§Œë“¤ì–´ì£¼ì„¸ìš”: "${selectedTopic}"

${grade ? `ëŒ€ìƒ í•™ë…„: ${grade}` : ''}
${subjectText ? `ê´€ë ¨ êµê³¼: ${subjectText}` : ''}
${purpose ? `í† ë¡  ëª©ì : ${purpose}` : ''}`;

                const scenario = await callOpenAI(prompt);
                
                hideAIProgress();
                generateBtn.disabled = false;
                
                displayFormattedScenario(scenario);
                showStatus('í† ë¡  ì‹œë‚˜ë¦¬ì˜¤ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                
            } catch (error) {
                console.error('ì‹œë‚˜ë¦¬ì˜¤ ìƒì„± ì˜¤ë¥˜:', error);
                hideAIProgress();
                generateBtn.disabled = false;
                showStatus('ì‹œë‚˜ë¦¬ì˜¤ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.', 'error');
            }
        }

        // ===== ì‹œë‚˜ë¦¬ì˜¤ í‘œì‹œ í•¨ìˆ˜ =====
        function displayFormattedScenario(scenario) {
            const container = document.getElementById('scenario-result');
            if (!container) {
                console.error('âŒ scenario-result ì»¨í…Œì´ë„ˆë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                return;
            }
            
            const sections = parseScenario(scenario);
            
            let html = '';
            
            // í† ë¡  ì œëª© ë° ì£¼ì œ ì„¹ì…˜
            if (sections.title || sections.topic) {
                html += `
                    <div class="scenario-section topic-section">
                        <h2>${sections.title || sections.topic}</h2>
                        ${sections.topic && sections.title !== sections.topic ? `<p class="topic-detail">${sections.topic}</p>` : ''}
                    </div>
                `;
            }
            
            // ë©”íƒ€ë°ì´í„° (í•™ë…„, êµê³¼, í‚¤ì›Œë“œ)
            if (sections.grade || sections.subject.length > 0 || sections.keywords.length > 0) {
                html += `
                    <div class="scenario-section metadata-section">
                        <h3><span class="icon">ğŸ“‹</span>í† ë¡  ì •ë³´</h3>
                        <div class="metadata-grid">
                            ${sections.grade ? `<div class="metadata-item"><strong>ëŒ€ìƒ í•™ë…„:</strong> ${sections.grade}</div>` : ''}
                            ${sections.subject.length > 0 ? `<div class="metadata-item"><strong>ê´€ë ¨ êµê³¼:</strong> ${sections.subject.join(', ')}</div>` : ''}
                            ${sections.keywords.length > 0 ? `<div class="metadata-item"><strong>í•µì‹¬ í‚¤ì›Œë“œ:</strong> ${sections.keywords.join(', ')}</div>` : ''}
                        </div>
                    </div>
                `;
            }
            
            // í† ë¡  ë°°ê²½ ì„¹ì…˜
            if (sections.background) {
                html += `
                    <div class="scenario-section">
                        <h3><span class="icon">ğŸ“š</span>í† ë¡  ë°°ê²½ ì„¤ëª…</h3>
                        <div class="scenario-content">
                            <p>${sections.background}</p>
                        </div>
                    </div>
                `;
            }
            
            // ì°¬ì„± vs ë°˜ëŒ€ ë…¼ì 
            if (sections.proArguments.length > 0 || sections.conArguments.length > 0) {
                html += `
                    <div class="scenario-section">
                        <h3><span class="icon">âš–ï¸</span>ì£¼ìš” ë…¼ì </h3>
                        <div class="pros-cons-container">
                            <div class="pros-box">
                                <h4>âœ… ì°¬ì„± ì¸¡ ë…¼ê±°</h4>
                                <div class="scenario-content">
                                    ${sections.proArguments.length > 0 
                                        ? `<ul>${sections.proArguments.map(arg => `<li>${arg}</li>`).join('')}</ul>`
                                        : '<p>ì°¬ì„± ë…¼ì ì„ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.</p>'}
                                </div>
                            </div>
                            <div class="cons-box">
                                <h4>âŒ ë°˜ëŒ€ ì¸¡ ë…¼ê±°</h4>
                                <div class="scenario-content">
                                    ${sections.conArguments.length > 0 
                                        ? `<ul>${sections.conArguments.map(arg => `<li>${arg}</li>`).join('')}</ul>`
                                        : '<p>ë°˜ëŒ€ ë…¼ì ì„ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.</p>'}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // í•µì‹¬ ì§ˆë¬¸ë“¤
            if (sections.keyQuestions.length > 0) {
                const topicPurposeField = document.getElementById('topic-purpose');
                const purpose = topicPurposeField ? topicPurposeField.value.trim() : '';
                const purposeClass = getPurposeClass(purpose);
                
                html += `
                    <div class="scenario-section ${purposeClass}">
                        <h3><span class="icon">â“</span>í•µì‹¬ ì§ˆë¬¸ë“¤ ${purpose ? `<span class="purpose-tag" data-purpose="${purpose}">${purpose}</span>` : ''}</h3>
                        <div class="scenario-content">
                            <ul class="key-questions-list">
                                ${sections.keyQuestions.map(question => `<li class="question-item">${question}</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                `;
            }
            
            // ê¸°ëŒ€ í•™ìŠµ ì„±ê³¼
            if (sections.expectedOutcomes.length > 0) {
                html += `
                    <div class="scenario-section">
                        <h3><span class="icon">ğŸ¯</span>ê¸°ëŒ€ í•™ìŠµ ì„±ê³¼</h3>
                        <div class="scenario-content">
                            <ul class="outcomes-list">
                                ${sections.expectedOutcomes.map(outcome => `<li>${outcome}</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                `;
            }
            
            // ì¤€ë¹„ë¬¼ (í† ê¸€ ë°©ì‹)
            if (sections.materials.length > 0) {
                const materialsId = 'materials-' + Math.random().toString(36).substr(2, 9);
                html += `
                    <div class="scenario-section">
                        <h3 class="materials-toggle" onclick="toggleMaterials('${materialsId}')" style="cursor: pointer; user-select: none;">
                            <span class="icon">ğŸ“¦</span>ì¤€ë¹„ë¬¼ 
                            <span class="toggle-indicator" id="${materialsId}-indicator">â–¼</span>
                        </h3>
                        <div class="scenario-content materials-content" id="${materialsId}" style="display: none;">
                            <ul class="materials-list">
                                ${sections.materials.map(material => `<li>${material}</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                `;
            }
            
            // êµì‚¬ ì§€ë„ íŒ
            if (sections.teacherTips) {
                const topicPurposeField = document.getElementById('topic-purpose');
                const purpose = topicPurposeField ? topicPurposeField.value.trim() : '';
                const purposeClass = getPurposeClass(purpose);
                
                html += `
                    <div class="scenario-section ${purposeClass}">
                        <h3><span class="icon">ğŸ‘©â€ğŸ«</span>êµì‚¬ ì§€ë„ íŒ ${purpose ? `<span class="purpose-tag" data-purpose="${purpose}">${purpose}</span>` : ''}</h3>
                        <div class="scenario-content">
                            <div class="teacher-tips-content">
                                <p>${sections.teacherTips}</p>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            if (html.length === 0) {
                html = '<div class="scenario-section"><p>ì‹œë‚˜ë¦¬ì˜¤ íŒŒì‹±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</p></div>';
            }
            
            container.innerHTML = html;
            
            // ì‹œë‚˜ë¦¬ì˜¤ ìƒì„± ì™„ë£Œ í›„ ì„¹ì…˜ í‘œì‹œ
            showSection('result-section');
            setTimeout(() => {
                document.querySelector('.scenario-section').scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'start' 
                });
            }, 100);
        }

        // ===== JSON ì‹œë‚˜ë¦¬ì˜¤ íŒŒì‹± í•¨ìˆ˜ =====
        function parseScenario(scenario) {
            // ê¸°ë³¸ êµ¬ì¡°ì²´
            const sections = {
                title: '',
                topic: '',
                background: '',
                proArguments: [],
                conArguments: [],
                teacherTips: '',
                keyQuestions: [],
                expectedOutcomes: [],
                materials: [],
                grade: '',
                subject: [],
                keywords: []
            };
            
            if (!scenario) {
                return sections;
            }

            // JSON íŒŒì‹± ì‹œë„
            try {
                let jsonData;
                
                // JSON í˜•ì‹ì¸ì§€ í™•ì¸
                if (scenario.trim().startsWith('{')) {
                    jsonData = JSON.parse(scenario);
                } else {
                    // ë§ˆí¬ë‹¤ìš´ ì½”ë“œ ë¸”ë¡ì—ì„œ JSON ì¶”ì¶œ
                    const jsonMatch = scenario.match(/```(?:json)?\s*(\{[\s\S]*?\})\s*```/);
                    if (jsonMatch) {
                        jsonData = JSON.parse(jsonMatch[1]);
                    } else {
                        // ë‹¨ìˆœ JSON ê°ì²´ ì°¾ê¸°
                        const jsonStart = scenario.indexOf('{');
                        const jsonEnd = scenario.lastIndexOf('}');
                        if (jsonStart !== -1 && jsonEnd !== -1 && jsonEnd > jsonStart) {
                            const jsonStr = scenario.substring(jsonStart, jsonEnd + 1);
                            jsonData = JSON.parse(jsonStr);
                        }
                    }
                }
                
                if (jsonData) {
                    // JSON ë°ì´í„°ë¥¼ sections êµ¬ì¡°ì— ë§¤í•‘
                    sections.title = jsonData.title || '';
                    sections.topic = jsonData.topic || '';
                    sections.background = jsonData.background || '';
                    sections.proArguments = Array.isArray(jsonData.proArguments) ? jsonData.proArguments : [];
                    sections.conArguments = Array.isArray(jsonData.conArguments) ? jsonData.conArguments : [];
                    sections.teacherTips = jsonData.teacherTips || '';
                    sections.keyQuestions = Array.isArray(jsonData.keyQuestions) ? jsonData.keyQuestions : [];
                    sections.expectedOutcomes = Array.isArray(jsonData.expectedOutcomes) ? jsonData.expectedOutcomes : [];
                    sections.materials = Array.isArray(jsonData.materials) ? jsonData.materials : [];
                    sections.grade = jsonData.grade || '';
                    sections.subject = Array.isArray(jsonData.subject) ? jsonData.subject : [];
                    sections.keywords = Array.isArray(jsonData.keywords) ? jsonData.keywords : [];
                    
                    return sections;
                } else {
                    throw new Error('JSON ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                }
            } catch (e) {
                console.log('âš ï¸ JSON íŒŒì‹± ì‹¤íŒ¨, ì›ë³¸ í…ìŠ¤íŠ¸ ë°˜í™˜:', e.message);
                
                // ë ˆê±°ì‹œ í…ìŠ¤íŠ¸ íŒŒì‹±ì„ ìœ„í•œ ê¸°ë³¸ê°’ ë°˜í™˜
                sections.topic = selectedTopic || 'í† ë¡  ì£¼ì œ';
                sections.background = scenario.substring(0, 200) + '...';
                
                return sections;
            }
        }

        // ===== í† ë¡  ëª©ì ë³„ ìŠ¤íƒ€ì¼ í´ë˜ìŠ¤ =====
        function getPurposeClass(purpose) {
            if (!purpose) return '';
            
            const purposeMapping = {
                'ë¹„íŒì ': 'purpose-critical',
                'ì˜ì‚¬ì†Œí†µ': 'purpose-communication', 
                'ì°½ì˜ì ': 'purpose-creative',
                'ë¯¼ì£¼': 'purpose-democratic',
                'ë‹¤ì–‘í•œ': 'purpose-perspective',
                'ê´€ì ': 'purpose-perspective'
            };
            
            // ëª©ì  í…ìŠ¤íŠ¸ì—ì„œ í‚¤ì›Œë“œ ì°¾ê¸°
            for (const [keyword, className] of Object.entries(purposeMapping)) {
                if (purpose.includes(keyword)) {
                    return className;
                }
            }
            
            return 'purpose-general';
        }

        // ===== ì¬ì¶”ì²œ ì‹œìŠ¤í…œ =====
        async function reRecommendTopics() {
            const keyword = document.getElementById('keyword').value.trim();
            
            if (!keyword) {
                showStatus('í‚¤ì›Œë“œë¥¼ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }

            // í”¼ë“œë°± ìˆ˜ì§‘
            const feedbackCheckboxes = document.querySelectorAll('input[name="feedback"]:checked');
            const manualFeedback = document.getElementById('manual-feedback').value.trim();
            
            const feedbackOptions = Array.from(feedbackCheckboxes).map(cb => cb.value);
            let feedbackText = '';
            
            if (feedbackOptions.length > 0) {
                feedbackText += `ë‹¤ìŒ í”¼ë“œë°±ì„ ë°˜ì˜í•´ì£¼ì„¸ìš”: ${feedbackOptions.join(', ')}. `;
            }
            
            if (manualFeedback) {
                feedbackText += `ì¶”ê°€ ìš”ì²­ì‚¬í•­: ${manualFeedback}`;
            }
            
            if (!feedbackText) {
                feedbackText = 'ì´ì „ ì£¼ì œë“¤ê³¼ëŠ” ë‹¤ë¥¸ ìƒˆë¡œìš´ ê´€ì ì˜ ì£¼ì œë¥¼ ì¶”ì²œí•´ì£¼ì„¸ìš”.';
            }

            const reRecommendBtn = document.getElementById('re-recommend-btn');
            reRecommendBtn.disabled = true;
            showAIProgress('re-recommend');

            try {
                const prompt = `í‚¤ì›Œë“œ: "${keyword}", í”¼ë“œë°±: ${feedbackText}, ì´ì „ ì£¼ì œë“¤: ${currentTopics.map(t => t.title).join(', ')} - ê°œì„ ëœ í† ë¡  ì£¼ì œ 3ê°œ ì¬ì¶”ì²œ`;
                const response = await callOpenAI(prompt + ' ì£¼ì œ ì¶”ì²œ');

                const topics = parseTopicResponse(response, keyword);
                displayTopics(topics);
                hideAIProgress();
                reRecommendBtn.disabled = false;
                showStatus('í”¼ë“œë°±ì„ ë°˜ì˜í•œ ìƒˆë¡œìš´ ì£¼ì œ 3ê°œë¥¼ ì¶”ì²œí–ˆìŠµë‹ˆë‹¤!', 'success');
                
                // í”¼ë“œë°± í¼ ì´ˆê¸°í™”
                document.querySelectorAll('input[name="feedback"]').forEach(cb => cb.checked = false);
                document.getElementById('manual-feedback').value = '';
                
            } catch (error) {
                console.error('ì¬ì¶”ì²œ ì˜¤ë¥˜:', error);
                hideAIProgress();
                reRecommendBtn.disabled = false;
                showStatus('ì¬ì¶”ì²œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.', 'error');
            }
        }

        // ===== ì¤€ë¹„ë¬¼ í† ê¸€ =====
        function toggleMaterials(materialsId) {
            const content = document.getElementById(materialsId);
            const indicator = document.getElementById(materialsId + '-indicator');
            
            if (content.style.display === 'none') {
                content.style.display = 'block';
                indicator.textContent = 'â–²';
                indicator.classList.add('rotated');
            } else {
                content.style.display = 'none';
                indicator.textContent = 'â–¼';
                indicator.classList.remove('rotated');
            }
        }

        // ===== ì‹œë‚˜ë¦¬ì˜¤ ì €ì¥ =====
        function saveScenario() {
            const content = document.getElementById('scenario-result');
            if (!content || content.innerHTML.trim() === '') {
                showStatus('ì €ì¥í•  ì‹œë‚˜ë¦¬ì˜¤ê°€ ì—†ìŠµë‹ˆë‹¤.', 'error');
                return;
            }
            
            const title = selectedTopic || 'í† ë¡ _ì‹œë‚˜ë¦¬ì˜¤';
            const date = new Date().toISOString().split('T')[0];
            const filename = `${title}_${date}.html`;
            
            const htmlContent = `
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${title} - AI í† ë¡  ì‹œë‚˜ë¦¬ì˜¤</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; margin: 20px; line-height: 1.6; }
        .scenario-section { margin-bottom: 30px; padding: 20px; border-radius: 8px; }
        h2, h3 { color: #3b82f6; }
        .pros-cons-container { display: flex; gap: 20px; }
        .pros-box, .cons-box { flex: 1; padding: 15px; border-radius: 8px; }
        .pros-box { background: #f0fdf4; border-left: 4px solid #10b981; }
        .cons-box { background: #fef2f2; border-left: 4px solid #ef4444; }
        ul { padding-left: 20px; }
        @media print { body { margin: 10px; } }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ¯ AI í† ë¡  ì‹œë‚˜ë¦¬ì˜¤</h1>
        <p>ìƒì„±ì¼: ${new Date().toLocaleDateString('ko-KR')}</p>
    </div>
    <div class="content">
        ${content.innerHTML}
    </div>
</body>
</html>
            `;
            
            const blob = new Blob([htmlContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
            
            showStatus('ì‹œë‚˜ë¦¬ì˜¤ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
        }

        // ===== ì‹œë‚˜ë¦¬ì˜¤ ì¸ì‡„ =====
        function printScenario() {
            const content = document.getElementById('scenario-result');
            if (!content || content.innerHTML.trim() === '') {
                showStatus('ì¸ì‡„í•  ì‹œë‚˜ë¦¬ì˜¤ê°€ ì—†ìŠµë‹ˆë‹¤.', 'error');
                return;
            }
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <!DOCTYPE html>
                <html lang="ko">
                <head>
                    <meta charset="UTF-8">
                    <title>${selectedTopic || 'í† ë¡  ì‹œë‚˜ë¦¬ì˜¤'} - ì¸ì‡„</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        h2, h3 { color: #2563eb; }
                        .pros-cons-container { display: flex; gap: 20px; }
                        .pros-box, .cons-box { flex: 1; }
                        ul { padding-left: 20px; }
                        @media print { body { margin: 10px; } }
                    </style>
                </head>
                <body>
                    ${content.innerHTML}
                </body>
                </html>
            `);
            
            printWindow.document.close();
            printWindow.print();
            showStatus('ì¸ì‡„ ì¤€ë¹„ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
        }

        // ===== ì‹œë‚˜ë¦¬ì˜¤ ë³µì‚¬ =====
        function copyScenario() {
            const content = document.getElementById('scenario-result');
            if (!content || content.innerHTML.trim() === '') {
                showStatus('ë³µì‚¬í•  ì‹œë‚˜ë¦¬ì˜¤ê°€ ì—†ìŠµë‹ˆë‹¤.', 'error');
                return;
            }
            
            const textContent = content.innerText;
            navigator.clipboard.writeText(textContent).then(() => {
                showStatus('ì‹œë‚˜ë¦¬ì˜¤ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
            }).catch(() => {
                showStatus('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
            });
        }

        // ===== AI ì§„í–‰ë¥  íŒì—… í•¨ìˆ˜ë“¤ =====
        let aiProgressModal = null;
        let progressSteps = [];
        let currentStep = 0;
        let progressInterval = null;

        function showAIProgress(type = 'topic') {
            // ì§„í–‰ ë‹¨ê³„ ì„¤ì •
            if (type === 'topic') {
                progressSteps = [
                    { text: 'í‚¤ì›Œë“œ ë¶„ì„ ì¤‘...', icon: 'ğŸ”' },
                    { text: 'ì£¼ì œ ì•„ì´ë””ì–´ ìƒì„± ì¤‘...', icon: 'ğŸ’¡' },
                    { text: 'êµìœ¡ì  ì í•©ì„± ê²€í†  ì¤‘...', icon: 'ğŸ“š' },
                    { text: 'ì°¬ë°˜ ë…¼ì  êµ¬ì„± ì¤‘...', icon: 'âš–ï¸' },
                    { text: 'ìµœì¢… ì£¼ì œ ì™„ì„± ì¤‘...', icon: 'âœ¨' }
                ];
            } else if (type === 'scenario') {
                progressSteps = [
                    { text: 'ì£¼ì œ ë¶„ì„ ì¤‘...', icon: 'ğŸ¯' },
                    { text: 'í† ë¡  êµ¬ì¡° ì„¤ê³„ ì¤‘...', icon: 'ğŸ—ï¸' },
                    { text: 'ë…¼ì  ìƒì„¸í™” ì¤‘...', icon: 'ğŸ“' },
                    { text: 'êµìœ¡ ìë£Œ êµ¬ì„± ì¤‘...', icon: 'ğŸ“š' },
                    { text: 'êµì‚¬ ê°€ì´ë“œ ìƒì„± ì¤‘...', icon: 'ğŸ‘©â€ğŸ«' },
                    { text: 'ìµœì¢… ì‹œë‚˜ë¦¬ì˜¤ ì™„ì„± ì¤‘...', icon: 'ğŸ‰' }
                ];
            } else if (type === 're-recommend') {
                progressSteps = [
                    { text: 'í”¼ë“œë°± ë¶„ì„ ì¤‘...', icon: 'ğŸ”„' },
                    { text: 'ì´ì „ ì£¼ì œ ê²€í†  ì¤‘...', icon: 'ğŸ“‹' },
                    { text: 'ìƒˆë¡œìš´ ì•„ì´ë””ì–´ ìƒì„± ì¤‘...', icon: 'ğŸ’¡' },
                    { text: 'ê°œì„ ëœ ì£¼ì œ êµ¬ì„± ì¤‘...', icon: 'ğŸ¯' },
                    { text: 'ìµœì¢… ì¶”ì²œ ì™„ì„± ì¤‘...', icon: 'âœ¨' }
                ];
            }
            
            currentStep = 0;
            
            // íŒì—… HTML ìƒì„±
            const titles = {
                'topic': 'í† ë¡  ì£¼ì œë¥¼ ìƒì„± ì¤‘ì…ë‹ˆë‹¤',
                'scenario': 'ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ìƒì„± ì¤‘ì…ë‹ˆë‹¤',
                're-recommend': 'ê°œì„ ëœ ì£¼ì œë¥¼ ì¶”ì²œ ì¤‘ì…ë‹ˆë‹¤'
            };
            
            const durations = {
                'topic': '10-15',
                'scenario': '20-30',
                're-recommend': '10-15'
            };
            
            const modalHTML = `
                <div class="ai-progress-overlay" id="ai-progress-overlay">
                    <div class="ai-progress-modal">
                        <div class="ai-progress-icon">ğŸ¤–</div>
                        <div class="ai-progress-title">${titles[type] || 'ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤'}</div>
                        <div class="ai-progress-subtitle">ì•½ ${durations[type] || '10-20'}ì´ˆ ì†Œìš”ë©ë‹ˆë‹¤</div>
                        
                        <div class="ai-progress-bar-container">
                            <div class="ai-progress-bar" id="ai-progress-bar"></div>
                        </div>
                        
                        <div class="ai-progress-steps">
                            ${progressSteps.map((step, index) => `
                                <div class="ai-progress-step" id="progress-step-${index}">
                                    <span class="ai-progress-step-icon">${step.icon}</span>
                                    <span>${step.text}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
            
            // DOMì— ì¶”ê°€
            document.body.insertAdjacentHTML('beforeend', modalHTML);
            aiProgressModal = document.getElementById('ai-progress-overlay');
            
            // ì§„í–‰ë¥  ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘
            startProgressAnimation();
        }

        function startProgressAnimation() {
            const progressBar = document.getElementById('ai-progress-bar');
            const totalSteps = progressSteps.length;
            const stepDuration = 2000; // ê° ë‹¨ê³„ë‹¹ 2ì´ˆ
            
            progressInterval = setInterval(() => {
                // ì´ì „ ë‹¨ê³„ ì™„ë£Œ í‘œì‹œ
                if (currentStep > 0) {
                    const prevStep = document.getElementById(`progress-step-${currentStep - 1}`);
                    if (prevStep) {
                        prevStep.classList.remove('active');
                        prevStep.classList.add('completed');
                        prevStep.querySelector('.ai-progress-step-icon').textContent = 'âœ…';
                    }
                }
                
                // í˜„ì¬ ë‹¨ê³„ í™œì„±í™”
                if (currentStep < totalSteps) {
                    const currentStepEl = document.getElementById(`progress-step-${currentStep}`);
                    if (currentStepEl) {
                        currentStepEl.classList.add('active');
                    }
                    
                    // ì§„í–‰ë¥  ë°” ì—…ë°ì´íŠ¸
                    const progress = ((currentStep + 1) / totalSteps) * 100;
                    if (progressBar) {
                        progressBar.style.width = `${progress}%`;
                    }
                    
                    currentStep++;
                } else {
                    // ëª¨ë“  ë‹¨ê³„ ì™„ë£Œ
                    clearInterval(progressInterval);
                }
            }, stepDuration);
        }

        function hideAIProgress() {
            if (progressInterval) {
                clearInterval(progressInterval);
                progressInterval = null;
            }
            
            if (aiProgressModal) {
                aiProgressModal.style.animation = 'aiProgressSlideIn 0.3s ease-out reverse';
                setTimeout(() => {
                    if (aiProgressModal) {
                        aiProgressModal.remove();
                        aiProgressModal = null;
                    }
                }, 300);
            }
        }
    </script>
</body>
</html>